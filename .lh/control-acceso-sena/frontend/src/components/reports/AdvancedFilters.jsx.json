{
    "sourceFile": "control-acceso-sena/frontend/src/components/reports/AdvancedFilters.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1764104822860,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764104921483,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,8 +19,9 @@\n \n   // Ref para rastrear si es la primera carga\n   const isInitialMount = useRef(true);\n   const onFilterRef = useRef(onFilter);\n+  const userInteractionRef = useRef(false);\n   \n   // Mantener referencia actualizada de onFilter sin causar re-renders\n   useEffect(() => {\n     onFilterRef.current = onFilter;\n@@ -36,37 +37,41 @@\n   }, []);\n \n   // Sincronizar filtros cuando cambian initialFilters (pero no llamar onFilter)\n   useEffect(() => {\n-    if (isInitialMount.current) {\n+    if (isInitialMount.current || !userInteractionRef.current) {\n       return;\n     }\n     setFilters(prev => ({ ...prev, ...initialFilters }));\n   }, [initialFilters]);\n \n-  // Notificar cambios solo cuando el usuario modifica los filtros manualmente\n-  // NO usar useEffect para esto, solo llamar directamente desde handleFilterChange\n+  // Notificar cambios cuando los filtros cambian (solo después de interacción del usuario)\n+  useEffect(() => {\n+    if (isInitialMount.current || !userInteractionRef.current) {\n+      return;\n+    }\n \n+    const activeFilters = Object.entries(filters)\n+      .filter(([k, v]) => v !== null && v !== undefined && v !== '')\n+      .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {});\n+\n+    // Usar setTimeout para diferir la llamada hasta después del renderizado\n+    const timeoutId = setTimeout(() => {\n+      onFilterRef.current(activeFilters);\n+    }, 0);\n+\n+    return () => clearTimeout(timeoutId);\n+  }, [filters]);\n+\n   const handleFilterChange = (key, value) => {\n-    setFilters(prev => {\n-      const updated = { ...prev, [key]: value };\n-      \n-      // Notificar cambio inmediatamente cuando el usuario modifica un filtro\n-      const activeFilters = Object.entries(updated)\n-        .filter(([k, v]) => v !== null && v !== undefined && v !== '')\n-        .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {});\n-      \n-      // Usar ref para evitar dependencias en useCallback\n-      onFilterRef.current(activeFilters);\n-      \n-      return updated;\n-    });\n+    userInteractionRef.current = true;\n+    setFilters(prev => ({ ...prev, [key]: value }));\n   };\n \n   const clearFilters = () => {\n+    userInteractionRef.current = true;\n     const cleared = Object.keys(filters).reduce((acc, key) => ({ ...acc, [key]: '' }), {});\n     setFilters(cleared);\n-    onFilterRef.current({});\n   };\n \n   const hasActiveFilters = Object.values(filters).some(value => value !== '' && value !== null && value !== undefined);\n \n"
                },
                {
                    "date": 1764109099674,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,16 +35,8 @@\n       return;\n     }\n   }, []);\n \n-  // Sincronizar filtros cuando cambian initialFilters (pero no llamar onFilter)\n-  useEffect(() => {\n-    if (isInitialMount.current || !userInteractionRef.current) {\n-      return;\n-    }\n-    setFilters(prev => ({ ...prev, ...initialFilters }));\n-  }, [initialFilters]);\n-\n   // Notificar cambios cuando los filtros cambian (solo después de interacción del usuario)\n   useEffect(() => {\n     if (isInitialMount.current || !userInteractionRef.current) {\n       return;\n@@ -56,9 +48,9 @@\n \n     // Usar setTimeout para diferir la llamada hasta después del renderizado\n     const timeoutId = setTimeout(() => {\n       onFilterRef.current(activeFilters);\n-    }, 0);\n+    }, 100);\n \n     return () => clearTimeout(timeoutId);\n   }, [filters]);\n \n"
                },
                {
                    "date": 1764228105351,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -122,12 +122,14 @@\n               onChange={(e) => handleFilterChange('rol', e.target.value)}\n               className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n             >\n               <option value=\"\">Todos</option>\n-              <option value=\"aprendiz\">Aprendiz</option>\n-              <option value=\"instructor\">Instructor</option>\n-              <option value=\"administrativo\">Administrativo</option>\n-              <option value=\"visitante\">Visitante</option>\n+              <option value=\"APRENDIZ\">Aprendiz</option>\n+              <option value=\"INSTRUCTOR\">Instructor</option>\n+              <option value=\"ADMINISTRATIVO\">Administrativo</option>\n+              <option value=\"VISITANTE\">Visitante</option>\n+              <option value=\"GUARDA\">Guarda</option>\n+              <option value=\"ADMINISTRADOR\">Administrador</option>\n             </select>\n           </div>\n         )}\n \n"
                }
            ],
            "date": 1764104822860,
            "name": "Commit-0",
            "content": "// AdvancedFilters - Componente de filtros avanzados\nimport React, { useState, useEffect, useRef } from 'react';\n\nconst AdvancedFilters = ({ onFilter, availableFilters = [], initialFilters = {} }) => {\n  const [filters, setFilters] = useState({\n    fecha_desde: initialFilters.fecha_desde || '',\n    fecha_hasta: initialFilters.fecha_hasta || '',\n    rol: initialFilters.rol || '',\n    programa: initialFilters.programa || '',\n    ficha: initialFilters.ficha || '',\n    zona: initialFilters.zona || '',\n    estado: initialFilters.estado || '',\n    documento: initialFilters.documento || '',\n    nombre: initialFilters.nombre || '',\n    tipo_acceso: initialFilters.tipo_acceso || '',\n    empresa: initialFilters.empresa || '',\n    ...initialFilters\n  });\n\n  // Ref para rastrear si es la primera carga\n  const isInitialMount = useRef(true);\n  const onFilterRef = useRef(onFilter);\n  \n  // Mantener referencia actualizada de onFilter sin causar re-renders\n  useEffect(() => {\n    onFilterRef.current = onFilter;\n  }, [onFilter]);\n\n  // Sincronizar con initialFilters solo en el primer render\n  useEffect(() => {\n    if (isInitialMount.current) {\n      isInitialMount.current = false;\n      // No llamar onFilter en el primer render\n      return;\n    }\n  }, []);\n\n  // Sincronizar filtros cuando cambian initialFilters (pero no llamar onFilter)\n  useEffect(() => {\n    if (isInitialMount.current) {\n      return;\n    }\n    setFilters(prev => ({ ...prev, ...initialFilters }));\n  }, [initialFilters]);\n\n  // Notificar cambios solo cuando el usuario modifica los filtros manualmente\n  // NO usar useEffect para esto, solo llamar directamente desde handleFilterChange\n\n  const handleFilterChange = (key, value) => {\n    setFilters(prev => {\n      const updated = { ...prev, [key]: value };\n      \n      // Notificar cambio inmediatamente cuando el usuario modifica un filtro\n      const activeFilters = Object.entries(updated)\n        .filter(([k, v]) => v !== null && v !== undefined && v !== '')\n        .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {});\n      \n      // Usar ref para evitar dependencias en useCallback\n      onFilterRef.current(activeFilters);\n      \n      return updated;\n    });\n  };\n\n  const clearFilters = () => {\n    const cleared = Object.keys(filters).reduce((acc, key) => ({ ...acc, [key]: '' }), {});\n    setFilters(cleared);\n    onFilterRef.current({});\n  };\n\n  const hasActiveFilters = Object.values(filters).some(value => value !== '' && value !== null && value !== undefined);\n\n  return (\n    <div className=\"advanced-filters bg-white rounded-lg shadow-md p-4 mb-6\">\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-lg font-semibold text-gray-800\">Filtros Avanzados</h3>\n        {hasActiveFilters && (\n          <button\n            onClick={clearFilters}\n            className=\"text-sm text-blue-600 hover:text-blue-800 font-medium\"\n          >\n            Limpiar Filtros\n          </button>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n        {/* Filtros de fecha */}\n        {(availableFilters.includes('fecha_desde') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Fecha Desde\n            </label>\n            <input\n              type=\"date\"\n              value={filters.fecha_desde}\n              onChange={(e) => handleFilterChange('fecha_desde', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            />\n          </div>\n        )}\n\n        {(availableFilters.includes('fecha_hasta') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Fecha Hasta\n            </label>\n            <input\n              type=\"date\"\n              value={filters.fecha_hasta}\n              onChange={(e) => handleFilterChange('fecha_hasta', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            />\n          </div>\n        )}\n\n        {/* Filtro de rol */}\n        {(availableFilters.includes('rol') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Rol\n            </label>\n            <select\n              value={filters.rol}\n              onChange={(e) => handleFilterChange('rol', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            >\n              <option value=\"\">Todos</option>\n              <option value=\"aprendiz\">Aprendiz</option>\n              <option value=\"instructor\">Instructor</option>\n              <option value=\"administrativo\">Administrativo</option>\n              <option value=\"visitante\">Visitante</option>\n            </select>\n          </div>\n        )}\n\n        {/* Filtro de estado */}\n        {(availableFilters.includes('estado') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Estado\n            </label>\n            <select\n              value={filters.estado}\n              onChange={(e) => handleFilterChange('estado', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            >\n              <option value=\"\">Todos</option>\n              <option value=\"activo\">Activo</option>\n              <option value=\"inactivo\">Inactivo</option>\n              <option value=\"suspendido\">Suspendido</option>\n            </select>\n          </div>\n        )}\n\n        {/* Filtro de documento */}\n        {(availableFilters.includes('documento') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Documento\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Buscar por documento...\"\n              value={filters.documento}\n              onChange={(e) => handleFilterChange('documento', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            />\n          </div>\n        )}\n\n        {/* Filtro de nombre */}\n        {(availableFilters.includes('nombre') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Nombre\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Buscar por nombre...\"\n              value={filters.nombre}\n              onChange={(e) => handleFilterChange('nombre', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            />\n          </div>\n        )}\n\n        {/* Filtro de tipo de acceso */}\n        {(availableFilters.includes('tipo_acceso') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Tipo de Acceso\n            </label>\n            <select\n              value={filters.tipo_acceso}\n              onChange={(e) => handleFilterChange('tipo_acceso', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            >\n              <option value=\"\">Todos</option>\n              <option value=\"entrada\">Entrada</option>\n              <option value=\"salida\">Salida</option>\n            </select>\n          </div>\n        )}\n\n        {/* Filtro de zona */}\n        {(availableFilters.includes('zona') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Zona/Ambiente\n            </label>\n            <select\n              value={filters.zona}\n              onChange={(e) => handleFilterChange('zona', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            >\n              <option value=\"\">Todas</option>\n              <option value=\"Área de Formación\">Área de Formación</option>\n              <option value=\"Área Administrativa\">Área Administrativa</option>\n              <option value=\"Área de Visitantes\">Área de Visitantes</option>\n              <option value=\"Bloque Principal\">Bloque Principal</option>\n            </select>\n          </div>\n        )}\n\n        {/* Filtro de empresa (para visitantes) */}\n        {(availableFilters.includes('empresa') || availableFilters.length === 0) && (\n          <div className=\"filter-group\">\n            <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n              Empresa/Contacto\n            </label>\n            <input\n              type=\"text\"\n              placeholder=\"Buscar por empresa...\"\n              value={filters.empresa}\n              onChange={(e) => handleFilterChange('empresa', e.target.value)}\n              className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AdvancedFilters;\n\n\n\n\n"
        }
    ]
}