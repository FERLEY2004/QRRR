{
    "sourceFile": "control-acceso-sena/frontend/src/components/reports/ExportButtons.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764109099639,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764109099639,
            "name": "Commit-0",
            "content": "// ExportButtons - Botones de exportación PDF/Excel\r\nimport React, { useState } from 'react';\r\nimport { exportAPI } from '../../services/api.js';\r\n\r\nconst ExportButtons = ({ reportType, filters = {}, data = null, onExportStart, onExportComplete, onExportError }) => {\r\n  const [exporting, setExporting] = useState({ pdf: false, excel: false });\r\n\r\n  const generatePDF = async (reportData, reportType, filters) => {\r\n    // Importar jsPDF dinámicamente\r\n    const { default: jsPDF } = await import('jspdf');\r\n    const doc = new jsPDF();\r\n    \r\n    // Configuración de colores\r\n    const primaryColor = [37, 99, 235]; // Azul\r\n    const secondaryColor = [107, 114, 128]; // Gris\r\n    \r\n    // Título\r\n    doc.setFontSize(20);\r\n    doc.setTextColor(...primaryColor);\r\n    doc.text('Reporte de Accesos - Sistema Control de Acceso SENA', 14, 20);\r\n    \r\n    // Fecha del reporte\r\n    doc.setFontSize(12);\r\n    doc.setTextColor(...secondaryColor);\r\n    doc.text(`Generado: ${new Date().toLocaleString('es-CO')}`, 14, 30);\r\n    \r\n    let yPosition = 45;\r\n    \r\n    // Filtros aplicados\r\n    if (Object.keys(filters).length > 0) {\r\n      doc.setFontSize(14);\r\n      doc.setTextColor(...primaryColor);\r\n      doc.text('Filtros Aplicados', 14, yPosition);\r\n      yPosition += 8;\r\n      \r\n      doc.setFontSize(10);\r\n      doc.setTextColor(0, 0, 0);\r\n      Object.entries(filters).forEach(([key, value]) => {\r\n        if (value) {\r\n          const label = key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase());\r\n          doc.text(`${label}: ${value}`, 14, yPosition);\r\n          yPosition += 6;\r\n        }\r\n      });\r\n      yPosition += 5;\r\n    }\r\n    \r\n    // Datos del reporte\r\n    if (reportData && reportData.data && reportData.data.length > 0) {\r\n      doc.setFontSize(14);\r\n      doc.setTextColor(...primaryColor);\r\n      doc.text('Datos del Reporte', 14, yPosition);\r\n      yPosition += 10;\r\n      \r\n      // Encabezados de tabla\r\n      const headers = [];\r\n      if (reportData.data[0]) {\r\n        headers.push(...Object.keys(reportData.data[0]).map(key => \r\n          key.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())\r\n        ));\r\n      }\r\n      \r\n      // Datos de la tabla\r\n      const tableData = reportData.data.map(row => \r\n        Object.values(row).map(val => String(val || ''))\r\n      );\r\n      \r\n      // Crear tabla simple\r\n      doc.setFontSize(8);\r\n      doc.setTextColor(0, 0, 0);\r\n      \r\n      const pageWidth = doc.internal.pageSize.width;\r\n      const margin = 14;\r\n      const tableWidth = pageWidth - (margin * 2);\r\n      const colWidth = tableWidth / (headers.length || 1);\r\n      \r\n      // Encabezados\r\n      headers.forEach((header, i) => {\r\n        doc.setFillColor(...primaryColor);\r\n        doc.rect(margin + (i * colWidth), yPosition, colWidth, 8, 'F');\r\n        doc.setTextColor(255, 255, 255);\r\n        doc.text(header.substring(0, 15), margin + (i * colWidth) + 2, yPosition + 5);\r\n      });\r\n      \r\n      yPosition += 8;\r\n      doc.setTextColor(0, 0, 0);\r\n      \r\n      // Filas de datos\r\n      tableData.slice(0, 20).forEach((row, rowIndex) => {\r\n        if (yPosition > 280) {\r\n          doc.addPage();\r\n          yPosition = 20;\r\n        }\r\n        \r\n        row.forEach((cell, colIndex) => {\r\n          doc.text(String(cell).substring(0, 15), margin + (colIndex * colWidth) + 2, yPosition);\r\n        });\r\n        yPosition += 6;\r\n      });\r\n      \r\n      // Paginación\r\n      if (reportData.pagination && reportData.pagination.total > 20) {\r\n        yPosition += 5;\r\n        doc.setFontSize(10);\r\n        doc.text(`Mostrando 20 de ${reportData.pagination.total} registros`, 14, yPosition);\r\n      }\r\n    } else {\r\n      doc.setFontSize(12);\r\n      doc.setTextColor(0, 0, 0);\r\n      doc.text('No hay datos para mostrar', 14, yPosition);\r\n    }\r\n    \r\n    // Descargar PDF\r\n    const timestamp = new Date().toISOString().split('T')[0];\r\n    doc.save(`reporte_${reportType}_${timestamp}.pdf`);\r\n  };\r\n\r\n  const handleExport = async (format) => {\r\n    if (!reportType) {\r\n      alert('Tipo de reporte no especificado');\r\n      return;\r\n    }\r\n\r\n    setExporting(prev => ({ ...prev, [format]: true }));\r\n    if (onExportStart) onExportStart(format);\r\n\r\n    try {\r\n      if (format === 'excel') {\r\n        await exportAPI.exportToExcel(reportType, filters);\r\n        if (onExportComplete) onExportComplete(format);\r\n      } else if (format === 'pdf') {\r\n        // Si tenemos datos, usarlos directamente, sino obtenerlos del backend\r\n        let reportData = data;\r\n        if (!reportData) {\r\n          const result = await exportAPI.exportToPDF(reportType, filters, data);\r\n          reportData = result.data || result;\r\n        }\r\n        \r\n        await generatePDF(reportData, reportType, filters);\r\n        if (onExportComplete) onExportComplete(format);\r\n      }\r\n    } catch (error) {\r\n      console.error(`Error exportando a ${format}:`, error);\r\n      const errorMessage = error.response?.data?.message || error.message || `Error al exportar a ${format}`;\r\n      alert(errorMessage);\r\n      if (onExportError) onExportError(format, error);\r\n    } finally {\r\n      setExporting(prev => ({ ...prev, [format]: false }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"export-buttons flex gap-3\">\r\n      <button\r\n        onClick={() => handleExport('excel')}\r\n        disabled={exporting.excel}\r\n        className=\"flex items-center gap-2 px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n      >\r\n        {exporting.excel ? (\r\n          <>\r\n            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\r\n            <span>Exportando...</span>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z\" />\r\n            </svg>\r\n            <span>Exportar Excel</span>\r\n          </>\r\n        )}\r\n      </button>\r\n\r\n      <button\r\n        onClick={() => handleExport('pdf')}\r\n        disabled={exporting.pdf}\r\n        className=\"flex items-center gap-2 px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n      >\r\n        {exporting.pdf ? (\r\n          <>\r\n            <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\"></div>\r\n            <span>Exportando...</span>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z\" />\r\n            </svg>\r\n            <span>Exportar PDF</span>\r\n          </>\r\n        )}\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ExportButtons;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"
        }
    ]
}