{
    "sourceFile": "control-acceso-sena/frontend/src/hooks/useReports.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1764024098809,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764104822905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,30 +1,36 @@\n // Hook para manejar reportes\n-import { useState, useEffect, useCallback } from 'react';\n+import { useState, useEffect, useCallback, useRef } from 'react';\n import { reportsAPI } from '../services/api.js';\n \n export const useReports = (reportType, initialFilters = {}) => {\n   const [data, setData] = useState(null);\n   const [loading, setLoading] = useState(false);\n   const [error, setError] = useState(null);\n   const [filters, setFilters] = useState(initialFilters);\n+  const filtersRef = useRef(initialFilters);\n+  const reportTypeRef = useRef(reportType);\n \n-  const loadReport = useCallback(async (currentFilters = filters) => {\n+  const loadReport = useCallback(async (currentFilters) => {\n     setLoading(true);\n     setError(null);\n     \n     try {\n       let result;\n+      const filtersToUse = currentFilters || filtersRef.current;\n       \n-      switch (reportType) {\n+      switch (reportTypeRef.current) {\n         case 'current-people':\n-          result = await reportsAPI.getCurrentPeople(currentFilters);\n+          result = await reportsAPI.getCurrentPeople(filtersToUse);\n           break;\n         case 'predictive-flows':\n-          result = await reportsAPI.getPredictiveFlows(currentFilters);\n+          result = await reportsAPI.getPredictiveFlows(filtersToUse);\n           break;\n+        case 'access-history':\n+          result = await reportsAPI.getAccessHistory(filtersToUse);\n+          break;\n         default:\n-          throw new Error(`Tipo de reporte desconocido: ${reportType}`);\n+          throw new Error(`Tipo de reporte desconocido: ${reportTypeRef.current}`);\n       }\n       \n       setData(result);\n     } catch (err) {\n@@ -32,13 +38,15 @@\n       console.error('Error cargando reporte:', err);\n     } finally {\n       setLoading(false);\n     }\n-  }, [reportType, filters]);\n+  }, []);\n \n   useEffect(() => {\n+    reportTypeRef.current = reportType;\n+    filtersRef.current = filters;\n     loadReport();\n-  }, [reportType]);\n+  }, [reportType, filters, loadReport]);\n \n   const updateFilters = useCallback((newFilters) => {\n     setFilters(prev => ({ ...prev, ...newFilters }));\n   }, []);\n"
                }
            ],
            "date": 1764024098808,
            "name": "Commit-0",
            "content": "// Hook para manejar reportes\nimport { useState, useEffect, useCallback } from 'react';\nimport { reportsAPI } from '../services/api.js';\n\nexport const useReports = (reportType, initialFilters = {}) => {\n  const [data, setData] = useState(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState(null);\n  const [filters, setFilters] = useState(initialFilters);\n\n  const loadReport = useCallback(async (currentFilters = filters) => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      let result;\n      \n      switch (reportType) {\n        case 'current-people':\n          result = await reportsAPI.getCurrentPeople(currentFilters);\n          break;\n        case 'predictive-flows':\n          result = await reportsAPI.getPredictiveFlows(currentFilters);\n          break;\n        default:\n          throw new Error(`Tipo de reporte desconocido: ${reportType}`);\n      }\n      \n      setData(result);\n    } catch (err) {\n      setError(err.response?.data?.message || err.message || 'Error al cargar reporte');\n      console.error('Error cargando reporte:', err);\n    } finally {\n      setLoading(false);\n    }\n  }, [reportType, filters]);\n\n  useEffect(() => {\n    loadReport();\n  }, [reportType]);\n\n  const updateFilters = useCallback((newFilters) => {\n    setFilters(prev => ({ ...prev, ...newFilters }));\n  }, []);\n\n  const refresh = useCallback(() => {\n    loadReport(filters);\n  }, [loadReport, filters]);\n\n  return {\n    data,\n    loading,\n    error,\n    filters,\n    updateFilters,\n    refresh,\n    loadReport\n  };\n};\n\n\n\n\n\n\n\n"
        }
    ]
}