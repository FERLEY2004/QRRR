{
    "sourceFile": "control-acceso-sena/frontend/src/hooks/useDashboard.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1764017519131,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764021641605,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,8 @@\n const useDashboard = () => {\n   const [data, setData] = useState({\n     metrics: null,\n     people: [],\n-    access: [],\n     alerts: []\n   });\n   const [loading, setLoading] = useState(true);\n   const [error, setError] = useState(null);\n@@ -31,13 +30,8 @@\n             console.error('Error fetching people (fallback):', altErr);\n             return { success: false, people: [] };\n           });\n         }),\n-        dashboardAPI.getRecentAccess(20).catch(err => {\n-          console.error('Error fetching recent access:', err);\n-          console.error('Error details:', err.response?.data || err.message);\n-          return { success: false, data: [] };\n-        }),\n         dashboardAPI.getAlerts().catch(err => {\n           console.error('Error fetching alerts:', err);\n           return { success: false, data: [] };\n         })\n@@ -45,92 +39,10 @@\n \n       // Procesar resultados, usando valores por defecto si fallaron\n       const metricsResponse = results[0].status === 'fulfilled' ? results[0].value : { success: false, data: null };\n       const peopleResponse = results[1].status === 'fulfilled' ? results[1].value : { success: false, people: [], data: [] };\n-      const accessResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n-      const alertsResponse = results[3].status === 'fulfilled' ? results[3].value : { success: false, data: [] };\n+      const alertsResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n \n-      // Debug: Log de respuestas detalladas con metadata\n-      console.log('ðŸ” [FRONTEND] Respuesta completa de accesos:', {\n-        success: accessResponse.success,\n-        data_count: accessResponse.data?.length || 0,\n-        metadata: accessResponse.metadata,\n-        request_id: accessResponse.metadata?.request_id\n-      });\n-      \n-      if (accessResponse.success === false) {\n-        console.warn('âš ï¸  [FRONTEND] La respuesta de accesos no fue exitosa:', accessResponse);\n-      } else {\n-        const accessCount = accessResponse.data?.length || 0;\n-        const metadata = accessResponse.metadata || {};\n-        \n-        console.log(`âœ… [FRONTEND] Accesos recibidos: ${accessCount}`);\n-        console.log(`ðŸ“Š [FRONTEND] Metadata:`, {\n-          source_table: metadata.source_table,\n-          processing_time_ms: metadata.processing_time_ms,\n-          request_id: metadata.request_id\n-        });\n-        \n-        if (accessResponse.data && accessResponse.data.length > 0) {\n-          console.log('ðŸ“‹ [FRONTEND] Primer acceso:', accessResponse.data[0]);\n-          console.log(`âœ… [FRONTEND] Total accesos a mostrar: ${accessCount}`);\n-        } else {\n-          console.warn('âš ï¸ [FRONTEND] No se recibieron accesos. Ejecutando diagnÃ³stico completo...');\n-          \n-          // Llamar al endpoint de diagnÃ³stico completo\n-          try {\n-            const diagResponse = await dashboardAPI.diagnoseTables();\n-            console.log('ðŸ“ˆ [FRONTEND] DiagnÃ³stico completo de tablas:', diagResponse);\n-            \n-            if (diagResponse.success && diagResponse.diagnostics) {\n-              const diag = diagResponse.diagnostics;\n-              const summary = diagResponse.summary || {};\n-              \n-              console.log('ðŸ“Š [FRONTEND] Resumen del diagnÃ³stico:');\n-              console.log(`   - Accesos total: ${summary.accesos_total || 0}`);\n-              console.log(`   - Registros total: ${summary.registros_total || 0}`);\n-              console.log(`   - Personas total: ${summary.personas_total || 0}`);\n-              console.log(`   - Errores: ${summary.errors_count || 0}`);\n-              \n-              if (diag.tables?.Accesos?.structure) {\n-                console.log(`   - Columnas en Accesos: ${diag.tables.Accesos.columns?.join(', ') || 'N/A'}`);\n-              }\n-              if (diag.tables?.registros_entrada_salida?.structure) {\n-                console.log(`   - Columnas en registros_entrada_salida: ${diag.tables.registros_entrada_salida.columns?.join(', ') || 'N/A'}`);\n-              }\n-              \n-              // Mostrar muestras de datos si existen\n-              if (diag.tables?.Accesos?.sample_records && diag.tables.Accesos.sample_records.length > 0) {\n-                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de Accesos:', diag.tables.Accesos.sample_records);\n-              }\n-              if (diag.tables?.registros_entrada_salida?.sample_records && diag.tables.registros_entrada_salida.sample_records.length > 0) {\n-                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de registros_entrada_salida:', diag.tables.registros_entrada_salida.sample_records);\n-              }\n-            }\n-            \n-            // TambiÃ©n llamar a getAccessStats para comparar\n-            try {\n-              const statsResponse = await dashboardAPI.getAccessStats();\n-              if (statsResponse.success) {\n-                const accesosTotal = statsResponse.accesos?.total_registros || 0;\n-                const registrosTotal = statsResponse.registros_entrada_salida?.total_registros || 0;\n-                \n-                if (accesosTotal === 0 && registrosTotal === 0) {\n-                  console.warn('ðŸš¨ [FRONTEND] Ambas tablas de accesos estÃ¡n VACÃAS');\n-                } else {\n-                  console.warn(`â„¹ï¸ [FRONTEND] Hay ${accesosTotal} registros en Accesos y ${registrosTotal} en registros_entrada_salida, pero 0 fueron retornados`);\n-                  console.warn('âš ï¸ [FRONTEND] Posible causa: Problema con los JOINs o filtros en la consulta SQL');\n-                }\n-              }\n-            } catch (statsError) {\n-              console.error('âŒ [FRONTEND] Error en getAccessStats:', statsError);\n-            }\n-          } catch (diagError) {\n-            console.error('âŒ [FRONTEND] Error ejecutando diagnÃ³stico completo:', diagError);\n-          }\n-        }\n-      }\n-\n       // Normalizar datos de personas: mapear nombre_completo a nombre para compatibilidad\n       let normalizedPeople = [];\n       if (peopleResponse.success) {\n         const peopleData = peopleResponse.people || peopleResponse.data || [];\n@@ -141,58 +53,17 @@\n           nombre_completo: person.nombre_completo || person.nombre || 'Sin nombre'\n         }));\n       }\n \n-      // Normalizar datos de accesos recientes\n-      let normalizedAccesses = [];\n-      if (accessResponse && accessResponse.success !== false) {\n-        const accessData = accessResponse.data || accessResponse || [];\n-        console.log('ðŸ“‹ [FRONTEND] Normalizando accesos recientes:', {\n-          success: accessResponse.success,\n-          total_recibidos: Array.isArray(accessData) ? accessData.length : 0,\n-          primer_acceso: Array.isArray(accessData) && accessData[0] ? accessData[0] : null,\n-          metadata: accessResponse.metadata\n-        });\n-        \n-        if (Array.isArray(accessData) && accessData.length > 0) {\n-          normalizedAccesses = accessData.map(access => ({\n-            ...access,\n-            // Asegurar que persona_nombre estÃ© presente\n-            persona_nombre: access.persona_nombre || access.nombre || 'Sin nombre',\n-            // Asegurar que tipo estÃ© normalizado\n-            tipo: (access.tipo || 'entrada').toLowerCase(),\n-            // Asegurar que fecha_evento estÃ© presente\n-            fecha_evento: access.fecha_evento || access.fecha_entrada || access.fecha_hora || null,\n-            // Mantener fecha_entrada para compatibilidad\n-            fecha_entrada: access.fecha_entrada || access.fecha_evento || access.fecha_hora || null\n-          }));\n-          \n-          console.log('âœ… [FRONTEND] Accesos normalizados:', {\n-            total_normalizados: normalizedAccesses.length,\n-            primer_acceso_normalizado: normalizedAccesses[0] || null\n-          });\n-        } else {\n-          console.log('â„¹ï¸ [FRONTEND] No hay accesos para mostrar (array vacÃ­o)');\n-        }\n-      } else {\n-        console.warn('âš ï¸ [FRONTEND] No se pudieron obtener accesos recientes:', {\n-          success: accessResponse?.success,\n-          message: accessResponse?.message,\n-          error: accessResponse?.error\n-        });\n-      }\n-\n       setData({\n         metrics: metricsResponse.success ? metricsResponse.data : null,\n         people: normalizedPeople,\n-        access: normalizedAccesses,\n         alerts: alertsResponse.success ? (alertsResponse.data || []) : []\n       });\n       \n       console.log('ðŸ“Š [FRONTEND] Datos finales del dashboard:', {\n         metrics: metricsResponse.success ? 'OK' : 'ERROR',\n         people_count: normalizedPeople.length,\n-        access_count: normalizedAccesses.length,\n         alerts_count: alertsResponse.success ? (alertsResponse.data?.length || 0) : 0\n       });\n \n       setLastUpdate(new Date());\n"
                },
                {
                    "date": 1764021785444,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,8 +5,9 @@\n const useDashboard = () => {\n   const [data, setData] = useState({\n     metrics: null,\n     people: [],\n+    access: [],\n     alerts: []\n   });\n   const [loading, setLoading] = useState(true);\n   const [error, setError] = useState(null);\n@@ -30,8 +31,13 @@\n             console.error('Error fetching people (fallback):', altErr);\n             return { success: false, people: [] };\n           });\n         }),\n+        dashboardAPI.getRecentAccess(20).catch(err => {\n+          console.error('Error fetching recent access:', err);\n+          console.error('Error details:', err.response?.data || err.message);\n+          return { success: false, data: [] };\n+        }),\n         dashboardAPI.getAlerts().catch(err => {\n           console.error('Error fetching alerts:', err);\n           return { success: false, data: [] };\n         })\n@@ -39,9 +45,10 @@\n \n       // Procesar resultados, usando valores por defecto si fallaron\n       const metricsResponse = results[0].status === 'fulfilled' ? results[0].value : { success: false, data: null };\n       const peopleResponse = results[1].status === 'fulfilled' ? results[1].value : { success: false, people: [], data: [] };\n-      const alertsResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n+      const accessResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n+      const alertsResponse = results[3].status === 'fulfilled' ? results[3].value : { success: false, data: [] };\n \n       // Normalizar datos de personas: mapear nombre_completo a nombre para compatibilidad\n       let normalizedPeople = [];\n       if (peopleResponse.success) {\n@@ -53,17 +60,38 @@\n           nombre_completo: person.nombre_completo || person.nombre || 'Sin nombre'\n         }));\n       }\n \n+      // Normalizar datos de accesos recientes\n+      let normalizedAccesses = [];\n+      if (accessResponse && accessResponse.success !== false) {\n+        const accessData = accessResponse.data || accessResponse || [];\n+        if (Array.isArray(accessData) && accessData.length > 0) {\n+          normalizedAccesses = accessData.map(access => ({\n+            ...access,\n+            // Asegurar que persona_nombre estÃ© presente\n+            persona_nombre: access.persona_nombre || access.nombre || 'Sin nombre',\n+            // Asegurar que tipo estÃ© normalizado\n+            tipo: (access.tipo || 'entrada').toLowerCase(),\n+            // Asegurar que fecha_evento estÃ© presente\n+            fecha_evento: access.fecha_evento || access.fecha_entrada || access.fecha_hora || null,\n+            // Mantener fecha_entrada para compatibilidad\n+            fecha_entrada: access.fecha_entrada || access.fecha_evento || access.fecha_hora || null\n+          }));\n+        }\n+      }\n+\n       setData({\n         metrics: metricsResponse.success ? metricsResponse.data : null,\n         people: normalizedPeople,\n+        access: normalizedAccesses,\n         alerts: alertsResponse.success ? (alertsResponse.data || []) : []\n       });\n       \n       console.log('ðŸ“Š [FRONTEND] Datos finales del dashboard:', {\n         metrics: metricsResponse.success ? 'OK' : 'ERROR',\n         people_count: normalizedPeople.length,\n+        access_count: normalizedAccesses.length,\n         alerts_count: alertsResponse.success ? (alertsResponse.data?.length || 0) : 0\n       });\n \n       setLastUpdate(new Date());\n"
                },
                {
                    "date": 1764021845333,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,8 +48,89 @@\n       const peopleResponse = results[1].status === 'fulfilled' ? results[1].value : { success: false, people: [], data: [] };\n       const accessResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n       const alertsResponse = results[3].status === 'fulfilled' ? results[3].value : { success: false, data: [] };\n \n+      // Debug: Log de respuestas detalladas con metadata\n+      console.log('ðŸ” [FRONTEND] Respuesta completa de accesos:', {\n+        success: accessResponse.success,\n+        data_count: accessResponse.data?.length || 0,\n+        metadata: accessResponse.metadata,\n+        request_id: accessResponse.metadata?.request_id\n+      });\n+      \n+      if (accessResponse.success === false) {\n+        console.warn('âš ï¸  [FRONTEND] La respuesta de accesos no fue exitosa:', accessResponse);\n+      } else {\n+        const accessCount = accessResponse.data?.length || 0;\n+        const metadata = accessResponse.metadata || {};\n+        \n+        console.log(`âœ… [FRONTEND] Accesos recibidos: ${accessCount}`);\n+        console.log(`ðŸ“Š [FRONTEND] Metadata:`, {\n+          source_table: metadata.source_table,\n+          processing_time_ms: metadata.processing_time_ms,\n+          request_id: metadata.request_id\n+        });\n+        \n+        if (accessResponse.data && accessResponse.data.length > 0) {\n+          console.log('ðŸ“‹ [FRONTEND] Primer acceso:', accessResponse.data[0]);\n+          console.log(`âœ… [FRONTEND] Total accesos a mostrar: ${accessCount}`);\n+        } else {\n+          console.warn('âš ï¸ [FRONTEND] No se recibieron accesos. Ejecutando diagnÃ³stico completo...');\n+          \n+          // Llamar al endpoint de diagnÃ³stico completo\n+          try {\n+            const diagResponse = await dashboardAPI.diagnoseTables();\n+            console.log('ðŸ“ˆ [FRONTEND] DiagnÃ³stico completo de tablas:', diagResponse);\n+            \n+            if (diagResponse.success && diagResponse.diagnostics) {\n+              const diag = diagResponse.diagnostics;\n+              const summary = diagResponse.summary || {};\n+              \n+              console.log('ðŸ“Š [FRONTEND] Resumen del diagnÃ³stico:');\n+              console.log(`   - Accesos total: ${summary.accesos_total || 0}`);\n+              console.log(`   - Registros total: ${summary.registros_total || 0}`);\n+              console.log(`   - Personas total: ${summary.personas_total || 0}`);\n+              console.log(`   - Errores: ${summary.errors_count || 0}`);\n+              \n+              if (diag.tables?.Accesos?.structure) {\n+                console.log(`   - Columnas en Accesos: ${diag.tables.Accesos.columns?.join(', ') || 'N/A'}`);\n+              }\n+              if (diag.tables?.registros_entrada_salida?.structure) {\n+                console.log(`   - Columnas en registros_entrada_salida: ${diag.tables.registros_entrada_salida.columns?.join(', ') || 'N/A'}`);\n+              }\n+              \n+              // Mostrar muestras de datos si existen\n+              if (diag.tables?.Accesos?.sample_records && diag.tables.Accesos.sample_records.length > 0) {\n+                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de Accesos:', diag.tables.Accesos.sample_records);\n+              }\n+              if (diag.tables?.registros_entrada_salida?.sample_records && diag.tables.registros_entrada_salida.sample_records.length > 0) {\n+                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de registros_entrada_salida:', diag.tables.registros_entrada_salida.sample_records);\n+              }\n+            }\n+            \n+            // TambiÃ©n llamar a getAccessStats para comparar\n+            try {\n+              const statsResponse = await dashboardAPI.getAccessStats();\n+              if (statsResponse.success) {\n+                const accesosTotal = statsResponse.accesos?.total_registros || 0;\n+                const registrosTotal = statsResponse.registros_entrada_salida?.total_registros || 0;\n+                \n+                if (accesosTotal === 0 && registrosTotal === 0) {\n+                  console.warn('ðŸš¨ [FRONTEND] Ambas tablas de accesos estÃ¡n VACÃAS');\n+                } else {\n+                  console.warn(`â„¹ï¸ [FRONTEND] Hay ${accesosTotal} registros en Accesos y ${registrosTotal} en registros_entrada_salida, pero 0 fueron retornados`);\n+                  console.warn('âš ï¸ [FRONTEND] Posible causa: Problema con los JOINs o filtros en la consulta SQL');\n+                }\n+              }\n+            } catch (statsError) {\n+              console.error('âŒ [FRONTEND] Error en getAccessStats:', statsError);\n+            }\n+          } catch (diagError) {\n+            console.error('âŒ [FRONTEND] Error ejecutando diagnÃ³stico completo:', diagError);\n+          }\n+        }\n+      }\n+\n       // Normalizar datos de personas: mapear nombre_completo a nombre para compatibilidad\n       let normalizedPeople = [];\n       if (peopleResponse.success) {\n         const peopleData = peopleResponse.people || peopleResponse.data || [];\n@@ -64,8 +145,15 @@\n       // Normalizar datos de accesos recientes\n       let normalizedAccesses = [];\n       if (accessResponse && accessResponse.success !== false) {\n         const accessData = accessResponse.data || accessResponse || [];\n+        console.log('ðŸ“‹ [FRONTEND] Normalizando accesos recientes:', {\n+          success: accessResponse.success,\n+          total_recibidos: Array.isArray(accessData) ? accessData.length : 0,\n+          primer_acceso: Array.isArray(accessData) && accessData[0] ? accessData[0] : null,\n+          metadata: accessResponse.metadata\n+        });\n+        \n         if (Array.isArray(accessData) && accessData.length > 0) {\n           normalizedAccesses = accessData.map(access => ({\n             ...access,\n             // Asegurar que persona_nombre estÃ© presente\n@@ -76,9 +164,22 @@\n             fecha_evento: access.fecha_evento || access.fecha_entrada || access.fecha_hora || null,\n             // Mantener fecha_entrada para compatibilidad\n             fecha_entrada: access.fecha_entrada || access.fecha_evento || access.fecha_hora || null\n           }));\n+          \n+          console.log('âœ… [FRONTEND] Accesos normalizados:', {\n+            total_normalizados: normalizedAccesses.length,\n+            primer_acceso_normalizado: normalizedAccesses[0] || null\n+          });\n+        } else {\n+          console.log('â„¹ï¸ [FRONTEND] No hay accesos para mostrar (array vacÃ­o)');\n         }\n+      } else {\n+        console.warn('âš ï¸ [FRONTEND] No se pudieron obtener accesos recientes:', {\n+          success: accessResponse?.success,\n+          message: accessResponse?.message,\n+          error: accessResponse?.error\n+        });\n       }\n \n       setData({\n         metrics: metricsResponse.success ? metricsResponse.data : null,\n"
                },
                {
                    "date": 1764021873765,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,9 +5,8 @@\n const useDashboard = () => {\n   const [data, setData] = useState({\n     metrics: null,\n     people: [],\n-    access: [],\n     alerts: []\n   });\n   const [loading, setLoading] = useState(true);\n   const [error, setError] = useState(null);\n@@ -31,13 +30,8 @@\n             console.error('Error fetching people (fallback):', altErr);\n             return { success: false, people: [] };\n           });\n         }),\n-        dashboardAPI.getRecentAccess(20).catch(err => {\n-          console.error('Error fetching recent access:', err);\n-          console.error('Error details:', err.response?.data || err.message);\n-          return { success: false, data: [] };\n-        }),\n         dashboardAPI.getAlerts().catch(err => {\n           console.error('Error fetching alerts:', err);\n           return { success: false, data: [] };\n         })\n@@ -45,92 +39,10 @@\n \n       // Procesar resultados, usando valores por defecto si fallaron\n       const metricsResponse = results[0].status === 'fulfilled' ? results[0].value : { success: false, data: null };\n       const peopleResponse = results[1].status === 'fulfilled' ? results[1].value : { success: false, people: [], data: [] };\n-      const accessResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n-      const alertsResponse = results[3].status === 'fulfilled' ? results[3].value : { success: false, data: [] };\n+      const alertsResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n \n-      // Debug: Log de respuestas detalladas con metadata\n-      console.log('ðŸ” [FRONTEND] Respuesta completa de accesos:', {\n-        success: accessResponse.success,\n-        data_count: accessResponse.data?.length || 0,\n-        metadata: accessResponse.metadata,\n-        request_id: accessResponse.metadata?.request_id\n-      });\n-      \n-      if (accessResponse.success === false) {\n-        console.warn('âš ï¸  [FRONTEND] La respuesta de accesos no fue exitosa:', accessResponse);\n-      } else {\n-        const accessCount = accessResponse.data?.length || 0;\n-        const metadata = accessResponse.metadata || {};\n-        \n-        console.log(`âœ… [FRONTEND] Accesos recibidos: ${accessCount}`);\n-        console.log(`ðŸ“Š [FRONTEND] Metadata:`, {\n-          source_table: metadata.source_table,\n-          processing_time_ms: metadata.processing_time_ms,\n-          request_id: metadata.request_id\n-        });\n-        \n-        if (accessResponse.data && accessResponse.data.length > 0) {\n-          console.log('ðŸ“‹ [FRONTEND] Primer acceso:', accessResponse.data[0]);\n-          console.log(`âœ… [FRONTEND] Total accesos a mostrar: ${accessCount}`);\n-        } else {\n-          console.warn('âš ï¸ [FRONTEND] No se recibieron accesos. Ejecutando diagnÃ³stico completo...');\n-          \n-          // Llamar al endpoint de diagnÃ³stico completo\n-          try {\n-            const diagResponse = await dashboardAPI.diagnoseTables();\n-            console.log('ðŸ“ˆ [FRONTEND] DiagnÃ³stico completo de tablas:', diagResponse);\n-            \n-            if (diagResponse.success && diagResponse.diagnostics) {\n-              const diag = diagResponse.diagnostics;\n-              const summary = diagResponse.summary || {};\n-              \n-              console.log('ðŸ“Š [FRONTEND] Resumen del diagnÃ³stico:');\n-              console.log(`   - Accesos total: ${summary.accesos_total || 0}`);\n-              console.log(`   - Registros total: ${summary.registros_total || 0}`);\n-              console.log(`   - Personas total: ${summary.personas_total || 0}`);\n-              console.log(`   - Errores: ${summary.errors_count || 0}`);\n-              \n-              if (diag.tables?.Accesos?.structure) {\n-                console.log(`   - Columnas en Accesos: ${diag.tables.Accesos.columns?.join(', ') || 'N/A'}`);\n-              }\n-              if (diag.tables?.registros_entrada_salida?.structure) {\n-                console.log(`   - Columnas en registros_entrada_salida: ${diag.tables.registros_entrada_salida.columns?.join(', ') || 'N/A'}`);\n-              }\n-              \n-              // Mostrar muestras de datos si existen\n-              if (diag.tables?.Accesos?.sample_records && diag.tables.Accesos.sample_records.length > 0) {\n-                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de Accesos:', diag.tables.Accesos.sample_records);\n-              }\n-              if (diag.tables?.registros_entrada_salida?.sample_records && diag.tables.registros_entrada_salida.sample_records.length > 0) {\n-                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de registros_entrada_salida:', diag.tables.registros_entrada_salida.sample_records);\n-              }\n-            }\n-            \n-            // TambiÃ©n llamar a getAccessStats para comparar\n-            try {\n-              const statsResponse = await dashboardAPI.getAccessStats();\n-              if (statsResponse.success) {\n-                const accesosTotal = statsResponse.accesos?.total_registros || 0;\n-                const registrosTotal = statsResponse.registros_entrada_salida?.total_registros || 0;\n-                \n-                if (accesosTotal === 0 && registrosTotal === 0) {\n-                  console.warn('ðŸš¨ [FRONTEND] Ambas tablas de accesos estÃ¡n VACÃAS');\n-                } else {\n-                  console.warn(`â„¹ï¸ [FRONTEND] Hay ${accesosTotal} registros en Accesos y ${registrosTotal} en registros_entrada_salida, pero 0 fueron retornados`);\n-                  console.warn('âš ï¸ [FRONTEND] Posible causa: Problema con los JOINs o filtros en la consulta SQL');\n-                }\n-              }\n-            } catch (statsError) {\n-              console.error('âŒ [FRONTEND] Error en getAccessStats:', statsError);\n-            }\n-          } catch (diagError) {\n-            console.error('âŒ [FRONTEND] Error ejecutando diagnÃ³stico completo:', diagError);\n-          }\n-        }\n-      }\n-\n       // Normalizar datos de personas: mapear nombre_completo a nombre para compatibilidad\n       let normalizedPeople = [];\n       if (peopleResponse.success) {\n         const peopleData = peopleResponse.people || peopleResponse.data || [];\n@@ -141,58 +53,17 @@\n           nombre_completo: person.nombre_completo || person.nombre || 'Sin nombre'\n         }));\n       }\n \n-      // Normalizar datos de accesos recientes\n-      let normalizedAccesses = [];\n-      if (accessResponse && accessResponse.success !== false) {\n-        const accessData = accessResponse.data || accessResponse || [];\n-        console.log('ðŸ“‹ [FRONTEND] Normalizando accesos recientes:', {\n-          success: accessResponse.success,\n-          total_recibidos: Array.isArray(accessData) ? accessData.length : 0,\n-          primer_acceso: Array.isArray(accessData) && accessData[0] ? accessData[0] : null,\n-          metadata: accessResponse.metadata\n-        });\n-        \n-        if (Array.isArray(accessData) && accessData.length > 0) {\n-          normalizedAccesses = accessData.map(access => ({\n-            ...access,\n-            // Asegurar que persona_nombre estÃ© presente\n-            persona_nombre: access.persona_nombre || access.nombre || 'Sin nombre',\n-            // Asegurar que tipo estÃ© normalizado\n-            tipo: (access.tipo || 'entrada').toLowerCase(),\n-            // Asegurar que fecha_evento estÃ© presente\n-            fecha_evento: access.fecha_evento || access.fecha_entrada || access.fecha_hora || null,\n-            // Mantener fecha_entrada para compatibilidad\n-            fecha_entrada: access.fecha_entrada || access.fecha_evento || access.fecha_hora || null\n-          }));\n-          \n-          console.log('âœ… [FRONTEND] Accesos normalizados:', {\n-            total_normalizados: normalizedAccesses.length,\n-            primer_acceso_normalizado: normalizedAccesses[0] || null\n-          });\n-        } else {\n-          console.log('â„¹ï¸ [FRONTEND] No hay accesos para mostrar (array vacÃ­o)');\n-        }\n-      } else {\n-        console.warn('âš ï¸ [FRONTEND] No se pudieron obtener accesos recientes:', {\n-          success: accessResponse?.success,\n-          message: accessResponse?.message,\n-          error: accessResponse?.error\n-        });\n-      }\n-\n       setData({\n         metrics: metricsResponse.success ? metricsResponse.data : null,\n         people: normalizedPeople,\n-        access: normalizedAccesses,\n         alerts: alertsResponse.success ? (alertsResponse.data || []) : []\n       });\n       \n       console.log('ðŸ“Š [FRONTEND] Datos finales del dashboard:', {\n         metrics: metricsResponse.success ? 'OK' : 'ERROR',\n         people_count: normalizedPeople.length,\n-        access_count: normalizedAccesses.length,\n         alerts_count: alertsResponse.success ? (alertsResponse.data?.length || 0) : 0\n       });\n \n       setLastUpdate(new Date());\n"
                }
            ],
            "date": 1764017519131,
            "name": "Commit-0",
            "content": "// useDashboard Hook - Hook personalizado para dashboard\nimport { useState, useEffect, useCallback } from 'react';\nimport { dashboardAPI, accessAPI, reportsAPI } from '../services/api';\n\nconst useDashboard = () => {\n  const [data, setData] = useState({\n    metrics: null,\n    people: [],\n    access: [],\n    alerts: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  const [lastUpdate, setLastUpdate] = useState(null);\n\n  const fetchData = useCallback(async () => {\n    try {\n      setError(null);\n      \n      // Cargar todas las datos en paralelo usando Promise.allSettled para que no falle completamente si una falla\n      // Usar reportsAPI.getCurrentPeople() que utiliza ReportService\n      const results = await Promise.allSettled([\n        dashboardAPI.getMetrics().catch(err => {\n          console.error('Error fetching metrics:', err);\n          return { success: false, data: null };\n        }),\n        reportsAPI.getCurrentPeople().catch(err => {\n          console.error('Error fetching people from reports:', err);\n          // Fallback al mÃ©todo antiguo si falla\n          return accessAPI.getCurrentPeople().catch(altErr => {\n            console.error('Error fetching people (fallback):', altErr);\n            return { success: false, people: [] };\n          });\n        }),\n        dashboardAPI.getRecentAccess(20).catch(err => {\n          console.error('Error fetching recent access:', err);\n          console.error('Error details:', err.response?.data || err.message);\n          return { success: false, data: [] };\n        }),\n        dashboardAPI.getAlerts().catch(err => {\n          console.error('Error fetching alerts:', err);\n          return { success: false, data: [] };\n        })\n      ]);\n\n      // Procesar resultados, usando valores por defecto si fallaron\n      const metricsResponse = results[0].status === 'fulfilled' ? results[0].value : { success: false, data: null };\n      const peopleResponse = results[1].status === 'fulfilled' ? results[1].value : { success: false, people: [], data: [] };\n      const accessResponse = results[2].status === 'fulfilled' ? results[2].value : { success: false, data: [] };\n      const alertsResponse = results[3].status === 'fulfilled' ? results[3].value : { success: false, data: [] };\n\n      // Debug: Log de respuestas detalladas con metadata\n      console.log('ðŸ” [FRONTEND] Respuesta completa de accesos:', {\n        success: accessResponse.success,\n        data_count: accessResponse.data?.length || 0,\n        metadata: accessResponse.metadata,\n        request_id: accessResponse.metadata?.request_id\n      });\n      \n      if (accessResponse.success === false) {\n        console.warn('âš ï¸  [FRONTEND] La respuesta de accesos no fue exitosa:', accessResponse);\n      } else {\n        const accessCount = accessResponse.data?.length || 0;\n        const metadata = accessResponse.metadata || {};\n        \n        console.log(`âœ… [FRONTEND] Accesos recibidos: ${accessCount}`);\n        console.log(`ðŸ“Š [FRONTEND] Metadata:`, {\n          source_table: metadata.source_table,\n          processing_time_ms: metadata.processing_time_ms,\n          request_id: metadata.request_id\n        });\n        \n        if (accessResponse.data && accessResponse.data.length > 0) {\n          console.log('ðŸ“‹ [FRONTEND] Primer acceso:', accessResponse.data[0]);\n          console.log(`âœ… [FRONTEND] Total accesos a mostrar: ${accessCount}`);\n        } else {\n          console.warn('âš ï¸ [FRONTEND] No se recibieron accesos. Ejecutando diagnÃ³stico completo...');\n          \n          // Llamar al endpoint de diagnÃ³stico completo\n          try {\n            const diagResponse = await dashboardAPI.diagnoseTables();\n            console.log('ðŸ“ˆ [FRONTEND] DiagnÃ³stico completo de tablas:', diagResponse);\n            \n            if (diagResponse.success && diagResponse.diagnostics) {\n              const diag = diagResponse.diagnostics;\n              const summary = diagResponse.summary || {};\n              \n              console.log('ðŸ“Š [FRONTEND] Resumen del diagnÃ³stico:');\n              console.log(`   - Accesos total: ${summary.accesos_total || 0}`);\n              console.log(`   - Registros total: ${summary.registros_total || 0}`);\n              console.log(`   - Personas total: ${summary.personas_total || 0}`);\n              console.log(`   - Errores: ${summary.errors_count || 0}`);\n              \n              if (diag.tables?.Accesos?.structure) {\n                console.log(`   - Columnas en Accesos: ${diag.tables.Accesos.columns?.join(', ') || 'N/A'}`);\n              }\n              if (diag.tables?.registros_entrada_salida?.structure) {\n                console.log(`   - Columnas en registros_entrada_salida: ${diag.tables.registros_entrada_salida.columns?.join(', ') || 'N/A'}`);\n              }\n              \n              // Mostrar muestras de datos si existen\n              if (diag.tables?.Accesos?.sample_records && diag.tables.Accesos.sample_records.length > 0) {\n                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de Accesos:', diag.tables.Accesos.sample_records);\n              }\n              if (diag.tables?.registros_entrada_salida?.sample_records && diag.tables.registros_entrada_salida.sample_records.length > 0) {\n                console.log('ðŸ“‹ [FRONTEND] Muestra de registros de registros_entrada_salida:', diag.tables.registros_entrada_salida.sample_records);\n              }\n            }\n            \n            // TambiÃ©n llamar a getAccessStats para comparar\n            try {\n              const statsResponse = await dashboardAPI.getAccessStats();\n              if (statsResponse.success) {\n                const accesosTotal = statsResponse.accesos?.total_registros || 0;\n                const registrosTotal = statsResponse.registros_entrada_salida?.total_registros || 0;\n                \n                if (accesosTotal === 0 && registrosTotal === 0) {\n                  console.warn('ðŸš¨ [FRONTEND] Ambas tablas de accesos estÃ¡n VACÃAS');\n                } else {\n                  console.warn(`â„¹ï¸ [FRONTEND] Hay ${accesosTotal} registros en Accesos y ${registrosTotal} en registros_entrada_salida, pero 0 fueron retornados`);\n                  console.warn('âš ï¸ [FRONTEND] Posible causa: Problema con los JOINs o filtros en la consulta SQL');\n                }\n              }\n            } catch (statsError) {\n              console.error('âŒ [FRONTEND] Error en getAccessStats:', statsError);\n            }\n          } catch (diagError) {\n            console.error('âŒ [FRONTEND] Error ejecutando diagnÃ³stico completo:', diagError);\n          }\n        }\n      }\n\n      // Normalizar datos de personas: mapear nombre_completo a nombre para compatibilidad\n      let normalizedPeople = [];\n      if (peopleResponse.success) {\n        const peopleData = peopleResponse.people || peopleResponse.data || [];\n        normalizedPeople = peopleData.map(person => ({\n          ...person,\n          // Si viene nombre_completo pero no nombre, usar nombre_completo como nombre\n          nombre: person.nombre || person.nombre_completo || 'Sin nombre',\n          nombre_completo: person.nombre_completo || person.nombre || 'Sin nombre'\n        }));\n      }\n\n      // Normalizar datos de accesos recientes\n      let normalizedAccesses = [];\n      if (accessResponse && accessResponse.success !== false) {\n        const accessData = accessResponse.data || accessResponse || [];\n        console.log('ðŸ“‹ [FRONTEND] Normalizando accesos recientes:', {\n          success: accessResponse.success,\n          total_recibidos: Array.isArray(accessData) ? accessData.length : 0,\n          primer_acceso: Array.isArray(accessData) && accessData[0] ? accessData[0] : null,\n          metadata: accessResponse.metadata\n        });\n        \n        if (Array.isArray(accessData) && accessData.length > 0) {\n          normalizedAccesses = accessData.map(access => ({\n            ...access,\n            // Asegurar que persona_nombre estÃ© presente\n            persona_nombre: access.persona_nombre || access.nombre || 'Sin nombre',\n            // Asegurar que tipo estÃ© normalizado\n            tipo: (access.tipo || 'entrada').toLowerCase(),\n            // Asegurar que fecha_evento estÃ© presente\n            fecha_evento: access.fecha_evento || access.fecha_entrada || access.fecha_hora || null,\n            // Mantener fecha_entrada para compatibilidad\n            fecha_entrada: access.fecha_entrada || access.fecha_evento || access.fecha_hora || null\n          }));\n          \n          console.log('âœ… [FRONTEND] Accesos normalizados:', {\n            total_normalizados: normalizedAccesses.length,\n            primer_acceso_normalizado: normalizedAccesses[0] || null\n          });\n        } else {\n          console.log('â„¹ï¸ [FRONTEND] No hay accesos para mostrar (array vacÃ­o)');\n        }\n      } else {\n        console.warn('âš ï¸ [FRONTEND] No se pudieron obtener accesos recientes:', {\n          success: accessResponse?.success,\n          message: accessResponse?.message,\n          error: accessResponse?.error\n        });\n      }\n\n      setData({\n        metrics: metricsResponse.success ? metricsResponse.data : null,\n        people: normalizedPeople,\n        access: normalizedAccesses,\n        alerts: alertsResponse.success ? (alertsResponse.data || []) : []\n      });\n      \n      console.log('ðŸ“Š [FRONTEND] Datos finales del dashboard:', {\n        metrics: metricsResponse.success ? 'OK' : 'ERROR',\n        people_count: normalizedPeople.length,\n        access_count: normalizedAccesses.length,\n        alerts_count: alertsResponse.success ? (alertsResponse.data?.length || 0) : 0\n      });\n\n      setLastUpdate(new Date());\n    } catch (err) {\n      console.error('Error fetching dashboard data:', err);\n      setError(err.response?.data?.message || 'Error al cargar datos del dashboard');\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    // Carga inicial\n    fetchData();\n\n    // Polling cada 30 segundos\n    const interval = setInterval(fetchData, 30000);\n\n    return () => clearInterval(interval);\n  }, [fetchData]);\n\n  return {\n    data,\n    loading,\n    error,\n    lastUpdate,\n    refresh: fetchData\n  };\n};\n\nexport default useDashboard;\n\n\n\n\n\n\n\n\n\n\n\n"
        }
    ]
}