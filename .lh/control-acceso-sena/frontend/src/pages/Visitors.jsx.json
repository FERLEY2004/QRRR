{
    "sourceFile": "control-acceso-sena/frontend/src/pages/Visitors.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1764024705060,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764024846518,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,6 @@\n // Visitors Page\r\n-import React, { useState } from 'react';\r\n+import React, { useState, useRef } from 'react';\r\n import { visitorAPI } from '../services/api';\r\n import { QRCodeSVG } from 'qrcode.react';\r\n \r\n // Función auxiliar para dividir texto en múltiples líneas\r\n@@ -34,8 +34,9 @@\n   const [loading, setLoading] = useState(false);\r\n   const [error, setError] = useState('');\r\n   const [success, setSuccess] = useState(null);\r\n   const [qrData, setQrData] = useState(null);\r\n+  const qrRef = useRef(null);\r\n \r\n   const handleChange = (e) => {\r\n     setFormData({\r\n       ...formData,\r\n@@ -208,9 +209,9 @@\n           <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n             <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Código QR Generado</h2>\r\n             {qrData ? (\r\n               <div className=\"text-center\">\r\n-                <div className=\"bg-white p-4 rounded-lg border-2 border-blue-500 inline-block mb-4\">\r\n+                <div className=\"bg-white p-4 rounded-lg border-2 border-blue-500 inline-block mb-4\" ref={qrRef}>\r\n                   <QRCodeSVG value={JSON.stringify(qrData.data)} size={256} />\r\n                 </div>\r\n                 <p className=\"text-sm text-gray-600 mb-2\">\r\n                   <strong>Válido hasta:</strong> {new Date(qrData.expiresAt).toLocaleString('es-CO')}\r\n@@ -219,21 +220,56 @@\n                   Este código QR expirará en 24 horas\r\n                 </p>\r\n                 <button\r\n                   onClick={() => {\r\n-                    const svgElement = document.querySelector('svg');\r\n-                    if (!svgElement) return;\r\n+                    // Buscar el SVG dentro del contenedor del QR\r\n+                    const qrContainer = qrRef.current;\r\n+                    if (!qrContainer) {\r\n+                      console.error('No se encontró el contenedor del QR');\r\n+                      return;\r\n+                    }\r\n+                    \r\n+                    const svgElement = qrContainer.querySelector('svg');\r\n+                    if (!svgElement) {\r\n+                      console.error('No se encontró el SVG del QR');\r\n+                      return;\r\n+                    }\r\n \r\n-                    const svgData = new XMLSerializer().serializeToString(svgElement);\r\n+                    // Obtener las dimensiones del SVG\r\n+                    const svgSize = 256; // Tamaño del QRCodeSVG\r\n+                    \r\n+                    // Clonar el SVG y asegurar que tenga las dimensiones correctas\r\n+                    const svgClone = svgElement.cloneNode(true);\r\n+                    \r\n+                    // Asegurar que el SVG tenga width y height explícitos\r\n+                    if (!svgClone.getAttribute('width')) {\r\n+                      svgClone.setAttribute('width', svgSize);\r\n+                    }\r\n+                    if (!svgClone.getAttribute('height')) {\r\n+                      svgClone.setAttribute('height', svgSize);\r\n+                    }\r\n+                    if (!svgClone.getAttribute('viewBox')) {\r\n+                      svgClone.setAttribute('viewBox', `0 0 ${svgSize} ${svgSize}`);\r\n+                    }\r\n+                    \r\n+                    // Asegurar que el SVG tenga fondo blanco\r\n+                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n+                    rect.setAttribute('width', svgSize);\r\n+                    rect.setAttribute('height', svgSize);\r\n+                    rect.setAttribute('fill', 'white');\r\n+                    svgClone.insertBefore(rect, svgClone.firstChild);\r\n+                    \r\n+                    // Serializar SVG\r\n+                    const svgData = new XMLSerializer().serializeToString(svgClone);\r\n                     const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\r\n                     const svgUrl = URL.createObjectURL(svgBlob);\r\n                     const img = new Image();\r\n                     \r\n                     img.onload = () => {\r\n                       // Crear canvas más grande para incluir texto\r\n-                      const qrSize = 400; // Tamaño del QR\r\n+                      const qrSize = 400; // Tamaño del QR en la imagen final\r\n                       const padding = 40;\r\n-                      const textAreaHeight = 200; // Espacio para texto\r\n+                      const textAreaHeight = 250; // Espacio para texto\r\n                       const canvas = document.createElement('canvas');\r\n                       canvas.width = qrSize + (padding * 2);\r\n                       canvas.height = qrSize + textAreaHeight + (padding * 3);\r\n                       \r\n@@ -242,11 +278,17 @@\n                       // Fondo blanco\r\n                       ctx.fillStyle = '#ffffff';\r\n                       ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n                       \r\n-                      // Dibujar QR centrado en la parte superior\r\n+                      // Dibujar QR centrado en la parte superior con mejor calidad\r\n                       const qrX = padding;\r\n                       const qrY = padding;\r\n+                      \r\n+                      // Mejorar la calidad del renderizado\r\n+                      ctx.imageSmoothingEnabled = true;\r\n+                      ctx.imageSmoothingQuality = 'high';\r\n+                      \r\n+                      // Dibujar el QR\r\n                       ctx.drawImage(img, qrX, qrY, qrSize, qrSize);\r\n                       \r\n                       // Configurar fuente para el texto\r\n                       const textX = canvas.width / 2;\r\n@@ -301,8 +343,14 @@\n                       }\r\n                       \r\n                       // Descargar imagen\r\n                       canvas.toBlob((blob) => {\r\n+                        if (!blob) {\r\n+                          console.error('Error al generar el blob de la imagen');\r\n+                          URL.revokeObjectURL(svgUrl);\r\n+                          return;\r\n+                        }\r\n+                        \r\n                         const url = URL.createObjectURL(blob);\r\n                         const a = document.createElement('a');\r\n                         a.href = url;\r\n                         a.download = `qr-visitante-${qrData.data.documento}.png`;\r\n@@ -310,11 +358,17 @@\n                         a.click();\r\n                         document.body.removeChild(a);\r\n                         URL.revokeObjectURL(url);\r\n                         URL.revokeObjectURL(svgUrl);\r\n-                      }, 'image/png');\r\n+                      }, 'image/png', 1.0); // Calidad máxima\r\n                     };\r\n                     \r\n+                    img.onerror = (error) => {\r\n+                      console.error('Error al cargar la imagen del QR:', error);\r\n+                      URL.revokeObjectURL(svgUrl);\r\n+                      alert('Error al generar la imagen del QR. Por favor, intente nuevamente.');\r\n+                    };\r\n+                    \r\n                     img.src = svgUrl;\r\n                   }}\r\n                   className=\"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold\"\r\n                 >\r\n"
                },
                {
                    "date": 1764100813926,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,393 +1,399 @@\n-// Visitors Page\r\n-import React, { useState, useRef } from 'react';\r\n-import { visitorAPI } from '../services/api';\r\n-import { QRCodeSVG } from 'qrcode.react';\r\n-\r\n-// Función auxiliar para dividir texto en múltiples líneas\r\n-const wrapText = (ctx, text, maxWidth, fontSize) => {\r\n-  const words = text.split(' ');\r\n-  const lines = [];\r\n-  let currentLine = words[0];\r\n-\r\n-  for (let i = 1; i < words.length; i++) {\r\n-    const word = words[i];\r\n-    const width = ctx.measureText(currentLine + ' ' + word).width;\r\n-    if (width < maxWidth) {\r\n-      currentLine += ' ' + word;\r\n-    } else {\r\n-      lines.push(currentLine);\r\n-      currentLine = word;\r\n-    }\r\n-  }\r\n-  lines.push(currentLine);\r\n-  return lines;\r\n-};\r\n-\r\n-const Visitors = () => {\r\n-  const [formData, setFormData] = useState({\r\n-    nombre: '',\r\n-    documento: '',\r\n-    tipo_documento: 'CC',\r\n-    motivo_visita: '',\r\n-    contacto: ''\r\n-  });\r\n-  const [loading, setLoading] = useState(false);\r\n-  const [error, setError] = useState('');\r\n-  const [success, setSuccess] = useState(null);\r\n-  const [qrData, setQrData] = useState(null);\r\n-  const qrRef = useRef(null);\r\n-\r\n-  const handleChange = (e) => {\r\n-    setFormData({\r\n-      ...formData,\r\n-      [e.target.name]: e.target.value\r\n-    });\r\n-  };\r\n-\r\n-  const handleSubmit = async (e) => {\r\n-    e.preventDefault();\r\n-    setError('');\r\n-    setLoading(true);\r\n-    setSuccess(null);\r\n-    setQrData(null);\r\n-\r\n-    try {\r\n-      const result = await visitorAPI.create(formData);\r\n-      setSuccess(result.message);\r\n-      setQrData({\r\n-        data: result.qrData,\r\n-        code: result.qrCode,\r\n-        expiresAt: result.expiresAt,\r\n-        nombre: result.visitor?.nombre || formData.nombre,\r\n-        motivo_visita: result.visitor?.motivo_visita || formData.motivo_visita,\r\n-        contacto: result.visitor?.contacto || formData.contacto\r\n-      });\r\n-      // Limpiar formulario\r\n-      setFormData({\r\n-        nombre: '',\r\n-        documento: '',\r\n-        tipo_documento: 'CC',\r\n-        motivo_visita: '',\r\n-        contacto: ''\r\n-      });\r\n-    } catch (err) {\r\n-      setError(err.response?.data?.message || 'Error al registrar visitante');\r\n-    } finally {\r\n-      setLoading(false);\r\n-    }\r\n-  };\r\n-\r\n-  return (\r\n-    <div className=\"min-h-screen bg-gray-100 p-4\">\r\n-      <div className=\"max-w-4xl mx-auto\">\r\n-        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\r\n-          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Registro de Visitantes</h1>\r\n-          <p className=\"text-gray-600\">Complete el formulario para generar un código QR temporal (24 horas)</p>\r\n-        </div>\r\n-\r\n-        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n-          {/* Formulario */}\r\n-          <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n-            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n-              {error && (\r\n-                <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\r\n-                  {error}\r\n-                </div>\r\n-              )}\r\n-\r\n-              {success && (\r\n-                <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg\">\r\n-                  {success}\r\n-                </div>\r\n-              )}\r\n-\r\n-              <div>\r\n-                <label htmlFor=\"nombre\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n-                  Nombre Completo *\r\n-                </label>\r\n-                <input\r\n-                  id=\"nombre\"\r\n-                  name=\"nombre\"\r\n-                  type=\"text\"\r\n-                  value={formData.nombre}\r\n-                  onChange={handleChange}\r\n-                  required\r\n-                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n-                  placeholder=\"Juan Pérez\"\r\n-                />\r\n-              </div>\r\n-\r\n-              <div className=\"grid grid-cols-2 gap-4\">\r\n-                <div>\r\n-                  <label htmlFor=\"tipo_documento\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n-                    Tipo Documento *\r\n-                  </label>\r\n-                  <select\r\n-                    id=\"tipo_documento\"\r\n-                    name=\"tipo_documento\"\r\n-                    value={formData.tipo_documento}\r\n-                    onChange={handleChange}\r\n-                    required\r\n-                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n-                  >\r\n-                    <option value=\"CC\">Cédula de Ciudadanía</option>\r\n-                    <option value=\"CE\">Cédula de Extranjería</option>\r\n-                    <option value=\"TI\">Tarjeta de Identidad</option>\r\n-                    <option value=\"PA\">Pasaporte</option>\r\n-                  </select>\r\n-                </div>\r\n-\r\n-                <div>\r\n-                  <label htmlFor=\"documento\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n-                    Número de Documento *\r\n-                  </label>\r\n-                  <input\r\n-                    id=\"documento\"\r\n-                    name=\"documento\"\r\n-                    type=\"text\"\r\n-                    value={formData.documento}\r\n-                    onChange={handleChange}\r\n-                    required\r\n-                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n-                    placeholder=\"1234567890\"\r\n-                  />\r\n-                </div>\r\n-              </div>\r\n-\r\n-              <div>\r\n-                <label htmlFor=\"motivo_visita\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n-                  Motivo de Visita *\r\n-                </label>\r\n-                <textarea\r\n-                  id=\"motivo_visita\"\r\n-                  name=\"motivo_visita\"\r\n-                  value={formData.motivo_visita}\r\n-                  onChange={handleChange}\r\n-                  required\r\n-                  rows=\"3\"\r\n-                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n-                  placeholder=\"Ej: Reunión con instructor, entrega de documentos...\"\r\n-                />\r\n-              </div>\r\n-\r\n-              <div>\r\n-                <label htmlFor=\"contacto\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n-                  Contacto (Teléfono/Email)\r\n-                </label>\r\n-                <input\r\n-                  id=\"contacto\"\r\n-                  name=\"contacto\"\r\n-                  type=\"text\"\r\n-                  value={formData.contacto}\r\n-                  onChange={handleChange}\r\n-                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n-                  placeholder=\"3001234567 o email@ejemplo.com\"\r\n-                />\r\n-              </div>\r\n-\r\n-              <button\r\n-                type=\"submit\"\r\n-                disabled={loading}\r\n-                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\r\n-              >\r\n-                {loading ? (\r\n-                  <>\r\n-                    <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n-                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n-                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n-                    </svg>\r\n-                    Registrando...\r\n-                  </>\r\n-                ) : (\r\n-                  'Registrar Visitante y Generar QR'\r\n-                )}\r\n-              </button>\r\n-            </form>\r\n-          </div>\r\n-\r\n-          {/* QR Code Display */}\r\n-          <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n-            <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Código QR Generado</h2>\r\n-            {qrData ? (\r\n-              <div className=\"text-center\">\r\n-                <div className=\"bg-white p-4 rounded-lg border-2 border-blue-500 inline-block mb-4\" ref={qrRef}>\r\n-                  <QRCodeSVG value={JSON.stringify(qrData.data)} size={256} />\r\n-                </div>\r\n-                <p className=\"text-sm text-gray-600 mb-2\">\r\n-                  <strong>Válido hasta:</strong> {new Date(qrData.expiresAt).toLocaleString('es-CO')}\r\n-                </p>\r\n-                <p className=\"text-xs text-gray-500\">\r\n-                  Este código QR expirará en 24 horas\r\n-                </p>\r\n-                <button\r\n-                  onClick={() => {\r\n-                    // Buscar el SVG dentro del contenedor del QR\r\n-                    const qrContainer = qrRef.current;\r\n-                    if (!qrContainer) {\r\n-                      console.error('No se encontró el contenedor del QR');\r\n-                      return;\r\n-                    }\r\n-                    \r\n-                    const svgElement = qrContainer.querySelector('svg');\r\n-                    if (!svgElement) {\r\n-                      console.error('No se encontró el SVG del QR');\r\n-                      return;\r\n-                    }\r\n-\r\n-                    // Obtener las dimensiones del SVG\r\n-                    const svgSize = 256; // Tamaño del QRCodeSVG\r\n-                    \r\n-                    // Clonar el SVG y asegurar que tenga las dimensiones correctas\r\n-                    const svgClone = svgElement.cloneNode(true);\r\n-                    \r\n-                    // Asegurar que el SVG tenga width y height explícitos\r\n-                    if (!svgClone.getAttribute('width')) {\r\n-                      svgClone.setAttribute('width', svgSize);\r\n-                    }\r\n-                    if (!svgClone.getAttribute('height')) {\r\n-                      svgClone.setAttribute('height', svgSize);\r\n-                    }\r\n-                    if (!svgClone.getAttribute('viewBox')) {\r\n-                      svgClone.setAttribute('viewBox', `0 0 ${svgSize} ${svgSize}`);\r\n-                    }\r\n-                    \r\n-                    // Asegurar que el SVG tenga fondo blanco\r\n-                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\r\n-                    rect.setAttribute('width', svgSize);\r\n-                    rect.setAttribute('height', svgSize);\r\n-                    rect.setAttribute('fill', 'white');\r\n-                    svgClone.insertBefore(rect, svgClone.firstChild);\r\n-                    \r\n-                    // Serializar SVG\r\n-                    const svgData = new XMLSerializer().serializeToString(svgClone);\r\n-                    const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\r\n-                    const svgUrl = URL.createObjectURL(svgBlob);\r\n-                    const img = new Image();\r\n-                    \r\n-                    img.onload = () => {\r\n-                      // Crear canvas más grande para incluir texto\r\n-                      const qrSize = 400; // Tamaño del QR en la imagen final\r\n-                      const padding = 40;\r\n-                      const textAreaHeight = 250; // Espacio para texto\r\n-                      const canvas = document.createElement('canvas');\r\n-                      canvas.width = qrSize + (padding * 2);\r\n-                      canvas.height = qrSize + textAreaHeight + (padding * 3);\r\n-                      \r\n-                      const ctx = canvas.getContext('2d');\r\n-                      \r\n-                      // Fondo blanco\r\n-                      ctx.fillStyle = '#ffffff';\r\n-                      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n-                      \r\n-                      // Dibujar QR centrado en la parte superior con mejor calidad\r\n-                      const qrX = padding;\r\n-                      const qrY = padding;\r\n-                      \r\n-                      // Mejorar la calidad del renderizado\r\n-                      ctx.imageSmoothingEnabled = true;\r\n-                      ctx.imageSmoothingQuality = 'high';\r\n-                      \r\n-                      // Dibujar el QR\r\n-                      ctx.drawImage(img, qrX, qrY, qrSize, qrSize);\r\n-                      \r\n-                      // Configurar fuente para el texto\r\n-                      const textX = canvas.width / 2;\r\n-                      let currentY = qrSize + padding * 2;\r\n-                      \r\n-                      // Estilo del texto\r\n-                      ctx.fillStyle = '#1f2937'; // Color gris oscuro\r\n-                      ctx.textAlign = 'center';\r\n-                      ctx.textBaseline = 'top';\r\n-                      \r\n-                      // Dibujar información (motivo de visita)\r\n-                      if (qrData.motivo_visita) {\r\n-                        ctx.font = 'bold 18px Arial, sans-serif';\r\n-                        ctx.fillStyle = '#374151';\r\n-                        ctx.fillText('Motivo de Visita:', textX, currentY);\r\n-                        currentY += 30;\r\n-                        \r\n-                        ctx.font = '14px Arial, sans-serif';\r\n-                        ctx.fillStyle = '#4b5563';\r\n-                        // Dividir texto largo en múltiples líneas\r\n-                        const motivoLines = wrapText(ctx, qrData.motivo_visita, canvas.width - padding * 2, 14);\r\n-                        motivoLines.forEach(line => {\r\n-                          ctx.fillText(line, textX, currentY);\r\n-                          currentY += 20;\r\n-                        });\r\n-                        currentY += 10;\r\n-                      }\r\n-                      \r\n-                      // Dibujar nombre\r\n-                      if (qrData.nombre) {\r\n-                        ctx.font = 'bold 18px Arial, sans-serif';\r\n-                        ctx.fillStyle = '#374151';\r\n-                        ctx.fillText('Nombre:', textX, currentY);\r\n-                        currentY += 30;\r\n-                        \r\n-                        ctx.font = '16px Arial, sans-serif';\r\n-                        ctx.fillStyle = '#1f2937';\r\n-                        ctx.fillText(qrData.nombre, textX, currentY);\r\n-                        currentY += 30;\r\n-                      }\r\n-                      \r\n-                      // Dibujar contacto\r\n-                      if (qrData.contacto) {\r\n-                        ctx.font = 'bold 18px Arial, sans-serif';\r\n-                        ctx.fillStyle = '#374151';\r\n-                        ctx.fillText('Contacto:', textX, currentY);\r\n-                        currentY += 30;\r\n-                        \r\n-                        ctx.font = '16px Arial, sans-serif';\r\n-                        ctx.fillStyle = '#1f2937';\r\n-                        ctx.fillText(qrData.contacto, textX, currentY);\r\n-                      }\r\n-                      \r\n-                      // Descargar imagen\r\n-                      canvas.toBlob((blob) => {\r\n-                        if (!blob) {\r\n-                          console.error('Error al generar el blob de la imagen');\r\n-                          URL.revokeObjectURL(svgUrl);\r\n-                          return;\r\n-                        }\r\n-                        \r\n-                        const url = URL.createObjectURL(blob);\r\n-                        const a = document.createElement('a');\r\n-                        a.href = url;\r\n-                        a.download = `qr-visitante-${qrData.data.documento}.png`;\r\n-                        document.body.appendChild(a);\r\n-                        a.click();\r\n-                        document.body.removeChild(a);\r\n-                        URL.revokeObjectURL(url);\r\n-                        URL.revokeObjectURL(svgUrl);\r\n-                      }, 'image/png', 1.0); // Calidad máxima\r\n-                    };\r\n-                    \r\n-                    img.onerror = (error) => {\r\n-                      console.error('Error al cargar la imagen del QR:', error);\r\n-                      URL.revokeObjectURL(svgUrl);\r\n-                      alert('Error al generar la imagen del QR. Por favor, intente nuevamente.');\r\n-                    };\r\n-                    \r\n-                    img.src = svgUrl;\r\n-                  }}\r\n-                  className=\"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold\"\r\n-                >\r\n-                  Descargar QR\r\n-                </button>\r\n-              </div>\r\n-            ) : (\r\n-              <div className=\"text-center py-12 text-gray-400\">\r\n-                <svg className=\"w-24 h-24 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n-                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\" />\r\n-                </svg>\r\n-                <p>Complete el formulario para generar el código QR</p>\r\n-              </div>\r\n-            )}\r\n-          </div>\r\n-        </div>\r\n-      </div>\r\n-    </div>\r\n-  );\r\n-};\r\n-\r\n-export default Visitors;\r\n+// Visitors Page\n+import React, { useState, useRef } from 'react';\n+import { visitorAPI } from '../services/api';\n+import { QRCodeSVG } from 'qrcode.react';\n+import logo from '../photos/Huella.png';\n+\n+// Función auxiliar para dividir texto en múltiples líneas\n+const wrapText = (ctx, text, maxWidth, fontSize) => {\n+  const words = text.split(' ');\n+  const lines = [];\n+  let currentLine = words[0];\n+\n+  for (let i = 1; i < words.length; i++) {\n+    const word = words[i];\n+    const width = ctx.measureText(currentLine + ' ' + word).width;\n+    if (width < maxWidth) {\n+      currentLine += ' ' + word;\n+    } else {\n+      lines.push(currentLine);\n+      currentLine = word;\n+    }\n+  }\n+  lines.push(currentLine);\n+  return lines;\n+};\n+\n+const Visitors = () => {\n+  const [formData, setFormData] = useState({\n+    nombre: '',\n+    documento: '',\n+    tipo_documento: 'CC',\n+    motivo_visita: '',\n+    contacto: ''\n+  });\n+  const [loading, setLoading] = useState(false);\n+  const [error, setError] = useState('');\n+  const [success, setSuccess] = useState(null);\n+  const [qrData, setQrData] = useState(null);\n+  const qrRef = useRef(null);\n+\n+  const handleChange = (e) => {\n+    setFormData({\n+      ...formData,\n+      [e.target.name]: e.target.value\n+    });\n+  };\n+\n+  const handleSubmit = async (e) => {\n+    e.preventDefault();\n+    setError('');\n+    setLoading(true);\n+    setSuccess(null);\n+    setQrData(null);\n+\n+    try {\n+      const result = await visitorAPI.create(formData);\n+      setSuccess(result.message);\n+      setQrData({\n+        data: result.qrData,\n+        code: result.qrCode,\n+        expiresAt: result.expiresAt,\n+        nombre: result.visitor?.nombre || formData.nombre,\n+        motivo_visita: result.visitor?.motivo_visita || formData.motivo_visita,\n+        contacto: result.visitor?.contacto || formData.contacto\n+      });\n+      // Limpiar formulario\n+      setFormData({\n+        nombre: '',\n+        documento: '',\n+        tipo_documento: 'CC',\n+        motivo_visita: '',\n+        contacto: ''\n+      });\n+    } catch (err) {\n+      setError(err.response?.data?.message || 'Error al registrar visitante');\n+    } finally {\n+      setLoading(false);\n+    }\n+  };\n+\n+  return (\n+    <div className=\"min-h-screen bg-gray-100 p-4\">\n+      <div className=\"max-w-4xl mx-auto\">\n+        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n+          <div className=\"flex items-center gap-4 mb-2\">\n+            <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n+            <div>\n+              <h1 className=\"text-3xl font-bold text-gray-800\">Registro de Visitantes</h1>\n+              <p className=\"text-gray-600 mt-1\">Complete el formulario para generar un código QR temporal (24 horas)</p>\n+            </div>\n+          </div>\n+        </div>\n+\n+        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n+          {/* Formulario */}\n+          <div className=\"bg-white rounded-lg shadow-lg p-6\">\n+            <form onSubmit={handleSubmit} className=\"space-y-4\">\n+              {error && (\n+                <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n+                  {error}\n+                </div>\n+              )}\n+\n+              {success && (\n+                <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg\">\n+                  {success}\n+                </div>\n+              )}\n+\n+              <div>\n+                <label htmlFor=\"nombre\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                  Nombre Completo *\n+                </label>\n+                <input\n+                  id=\"nombre\"\n+                  name=\"nombre\"\n+                  type=\"text\"\n+                  value={formData.nombre}\n+                  onChange={handleChange}\n+                  required\n+                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\n+                  placeholder=\"Juan Pérez\"\n+                />\n+              </div>\n+\n+              <div className=\"grid grid-cols-2 gap-4\">\n+                <div>\n+                  <label htmlFor=\"tipo_documento\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                    Tipo Documento *\n+                  </label>\n+                  <select\n+                    id=\"tipo_documento\"\n+                    name=\"tipo_documento\"\n+                    value={formData.tipo_documento}\n+                    onChange={handleChange}\n+                    required\n+                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\n+                  >\n+                    <option value=\"CC\">Cédula de Ciudadanía</option>\n+                    <option value=\"CE\">Cédula de Extranjería</option>\n+                    <option value=\"TI\">Tarjeta de Identidad</option>\n+                    <option value=\"PA\">Pasaporte</option>\n+                  </select>\n+                </div>\n+\n+                <div>\n+                  <label htmlFor=\"documento\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                    Número de Documento *\n+                  </label>\n+                  <input\n+                    id=\"documento\"\n+                    name=\"documento\"\n+                    type=\"text\"\n+                    value={formData.documento}\n+                    onChange={handleChange}\n+                    required\n+                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\n+                    placeholder=\"1234567890\"\n+                  />\n+                </div>\n+              </div>\n+\n+              <div>\n+                <label htmlFor=\"motivo_visita\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                  Motivo de Visita *\n+                </label>\n+                <textarea\n+                  id=\"motivo_visita\"\n+                  name=\"motivo_visita\"\n+                  value={formData.motivo_visita}\n+                  onChange={handleChange}\n+                  required\n+                  rows=\"3\"\n+                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\n+                  placeholder=\"Ej: Reunión con instructor, entrega de documentos...\"\n+                />\n+              </div>\n+\n+              <div>\n+                <label htmlFor=\"contacto\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                  Contacto (Teléfono/Email)\n+                </label>\n+                <input\n+                  id=\"contacto\"\n+                  name=\"contacto\"\n+                  type=\"text\"\n+                  value={formData.contacto}\n+                  onChange={handleChange}\n+                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\n+                  placeholder=\"3001234567 o email@ejemplo.com\"\n+                />\n+              </div>\n+\n+              <button\n+                type=\"submit\"\n+                disabled={loading}\n+                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\n+              >\n+                {loading ? (\n+                  <>\n+                    <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n+                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n+                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\n+                    </svg>\n+                    Registrando...\n+                  </>\n+                ) : (\n+                  'Registrar Visitante y Generar QR'\n+                )}\n+              </button>\n+            </form>\n+          </div>\n+\n+          {/* QR Code Display */}\n+          <div className=\"bg-white rounded-lg shadow-lg p-6\">\n+            <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Código QR Generado</h2>\n+            {qrData ? (\n+              <div className=\"text-center\">\n+                <div className=\"bg-white p-4 rounded-lg border-2 border-blue-500 inline-block mb-4\" ref={qrRef}>\n+                  <QRCodeSVG value={JSON.stringify(qrData.data)} size={256} />\n+                </div>\n+                <p className=\"text-sm text-gray-600 mb-2\">\n+                  <strong>Válido hasta:</strong> {new Date(qrData.expiresAt).toLocaleString('es-CO')}\n+                </p>\n+                <p className=\"text-xs text-gray-500\">\n+                  Este código QR expirará en 24 horas\n+                </p>\n+                <button\n+                  onClick={() => {\n+                    // Buscar el SVG dentro del contenedor del QR\n+                    const qrContainer = qrRef.current;\n+                    if (!qrContainer) {\n+                      console.error('No se encontró el contenedor del QR');\n+                      return;\n+                    }\n+                    \n+                    const svgElement = qrContainer.querySelector('svg');\n+                    if (!svgElement) {\n+                      console.error('No se encontró el SVG del QR');\n+                      return;\n+                    }\n+\n+                    // Obtener las dimensiones del SVG\n+                    const svgSize = 256; // Tamaño del QRCodeSVG\n+                    \n+                    // Clonar el SVG y asegurar que tenga las dimensiones correctas\n+                    const svgClone = svgElement.cloneNode(true);\n+                    \n+                    // Asegurar que el SVG tenga width y height explícitos\n+                    if (!svgClone.getAttribute('width')) {\n+                      svgClone.setAttribute('width', svgSize);\n+                    }\n+                    if (!svgClone.getAttribute('height')) {\n+                      svgClone.setAttribute('height', svgSize);\n+                    }\n+                    if (!svgClone.getAttribute('viewBox')) {\n+                      svgClone.setAttribute('viewBox', `0 0 ${svgSize} ${svgSize}`);\n+                    }\n+                    \n+                    // Asegurar que el SVG tenga fondo blanco\n+                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');\n+                    rect.setAttribute('width', svgSize);\n+                    rect.setAttribute('height', svgSize);\n+                    rect.setAttribute('fill', 'white');\n+                    svgClone.insertBefore(rect, svgClone.firstChild);\n+                    \n+                    // Serializar SVG\n+                    const svgData = new XMLSerializer().serializeToString(svgClone);\n+                    const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\n+                    const svgUrl = URL.createObjectURL(svgBlob);\n+                    const img = new Image();\n+                    \n+                    img.onload = () => {\n+                      // Crear canvas más grande para incluir texto\n+                      const qrSize = 400; // Tamaño del QR en la imagen final\n+                      const padding = 40;\n+                      const textAreaHeight = 250; // Espacio para texto\n+                      const canvas = document.createElement('canvas');\n+                      canvas.width = qrSize + (padding * 2);\n+                      canvas.height = qrSize + textAreaHeight + (padding * 3);\n+                      \n+                      const ctx = canvas.getContext('2d');\n+                      \n+                      // Fondo blanco\n+                      ctx.fillStyle = '#ffffff';\n+                      ctx.fillRect(0, 0, canvas.width, canvas.height);\n+                      \n+                      // Dibujar QR centrado en la parte superior con mejor calidad\n+                      const qrX = padding;\n+                      const qrY = padding;\n+                      \n+                      // Mejorar la calidad del renderizado\n+                      ctx.imageSmoothingEnabled = true;\n+                      ctx.imageSmoothingQuality = 'high';\n+                      \n+                      // Dibujar el QR\n+                      ctx.drawImage(img, qrX, qrY, qrSize, qrSize);\n+                      \n+                      // Configurar fuente para el texto\n+                      const textX = canvas.width / 2;\n+                      let currentY = qrSize + padding * 2;\n+                      \n+                      // Estilo del texto\n+                      ctx.fillStyle = '#1f2937'; // Color gris oscuro\n+                      ctx.textAlign = 'center';\n+                      ctx.textBaseline = 'top';\n+                      \n+                      // Dibujar información (motivo de visita)\n+                      if (qrData.motivo_visita) {\n+                        ctx.font = 'bold 18px Arial, sans-serif';\n+                        ctx.fillStyle = '#374151';\n+                        ctx.fillText('Motivo de Visita:', textX, currentY);\n+                        currentY += 30;\n+                        \n+                        ctx.font = '14px Arial, sans-serif';\n+                        ctx.fillStyle = '#4b5563';\n+                        // Dividir texto largo en múltiples líneas\n+                        const motivoLines = wrapText(ctx, qrData.motivo_visita, canvas.width - padding * 2, 14);\n+                        motivoLines.forEach(line => {\n+                          ctx.fillText(line, textX, currentY);\n+                          currentY += 20;\n+                        });\n+                        currentY += 10;\n+                      }\n+                      \n+                      // Dibujar nombre\n+                      if (qrData.nombre) {\n+                        ctx.font = 'bold 18px Arial, sans-serif';\n+                        ctx.fillStyle = '#374151';\n+                        ctx.fillText('Nombre:', textX, currentY);\n+                        currentY += 30;\n+                        \n+                        ctx.font = '16px Arial, sans-serif';\n+                        ctx.fillStyle = '#1f2937';\n+                        ctx.fillText(qrData.nombre, textX, currentY);\n+                        currentY += 30;\n+                      }\n+                      \n+                      // Dibujar contacto\n+                      if (qrData.contacto) {\n+                        ctx.font = 'bold 18px Arial, sans-serif';\n+                        ctx.fillStyle = '#374151';\n+                        ctx.fillText('Contacto:', textX, currentY);\n+                        currentY += 30;\n+                        \n+                        ctx.font = '16px Arial, sans-serif';\n+                        ctx.fillStyle = '#1f2937';\n+                        ctx.fillText(qrData.contacto, textX, currentY);\n+                      }\n+                      \n+                      // Descargar imagen\n+                      canvas.toBlob((blob) => {\n+                        if (!blob) {\n+                          console.error('Error al generar el blob de la imagen');\n+                          URL.revokeObjectURL(svgUrl);\n+                          return;\n+                        }\n+                        \n+                        const url = URL.createObjectURL(blob);\n+                        const a = document.createElement('a');\n+                        a.href = url;\n+                        a.download = `qr-visitante-${qrData.data.documento}.png`;\n+                        document.body.appendChild(a);\n+                        a.click();\n+                        document.body.removeChild(a);\n+                        URL.revokeObjectURL(url);\n+                        URL.revokeObjectURL(svgUrl);\n+                      }, 'image/png', 1.0); // Calidad máxima\n+                    };\n+                    \n+                    img.onerror = (error) => {\n+                      console.error('Error al cargar la imagen del QR:', error);\n+                      URL.revokeObjectURL(svgUrl);\n+                      alert('Error al generar la imagen del QR. Por favor, intente nuevamente.');\n+                    };\n+                    \n+                    img.src = svgUrl;\n+                  }}\n+                  className=\"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold\"\n+                >\n+                  Descargar QR\n+                </button>\n+              </div>\n+            ) : (\n+              <div className=\"text-center py-12 text-gray-400\">\n+                <svg className=\"w-24 h-24 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n+                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\" />\n+                </svg>\n+                <p>Complete el formulario para generar el código QR</p>\n+              </div>\n+            )}\n+          </div>\n+        </div>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default Visitors;\n"
                },
                {
                    "date": 1764102796100,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,8 @@\n // Visitors Page\n import React, { useState, useRef } from 'react';\n import { visitorAPI } from '../services/api';\n import { QRCodeSVG } from 'qrcode.react';\n-import logo from '../photos/Huella.png';\n \n // Función auxiliar para dividir texto en múltiples líneas\n const wrapText = (ctx, text, maxWidth, fontSize) => {\n   const words = text.split(' ');\n@@ -81,15 +80,10 @@\n   return (\n     <div className=\"min-h-screen bg-gray-100 p-4\">\n       <div className=\"max-w-4xl mx-auto\">\n         <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\n-          <div className=\"flex items-center gap-4 mb-2\">\n-            <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n-            <div>\n-              <h1 className=\"text-3xl font-bold text-gray-800\">Registro de Visitantes</h1>\n-              <p className=\"text-gray-600 mt-1\">Complete el formulario para generar un código QR temporal (24 horas)</p>\n-            </div>\n-          </div>\n+          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Registro de Visitantes</h1>\n+          <p className=\"text-gray-600\">Complete el formulario para generar un código QR temporal (24 horas)</p>\n         </div>\n \n         <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n           {/* Formulario */}\n"
                }
            ],
            "date": 1764024705060,
            "name": "Commit-0",
            "content": "// Visitors Page\r\nimport React, { useState } from 'react';\r\nimport { visitorAPI } from '../services/api';\r\nimport { QRCodeSVG } from 'qrcode.react';\r\n\r\n// Función auxiliar para dividir texto en múltiples líneas\r\nconst wrapText = (ctx, text, maxWidth, fontSize) => {\r\n  const words = text.split(' ');\r\n  const lines = [];\r\n  let currentLine = words[0];\r\n\r\n  for (let i = 1; i < words.length; i++) {\r\n    const word = words[i];\r\n    const width = ctx.measureText(currentLine + ' ' + word).width;\r\n    if (width < maxWidth) {\r\n      currentLine += ' ' + word;\r\n    } else {\r\n      lines.push(currentLine);\r\n      currentLine = word;\r\n    }\r\n  }\r\n  lines.push(currentLine);\r\n  return lines;\r\n};\r\n\r\nconst Visitors = () => {\r\n  const [formData, setFormData] = useState({\r\n    nombre: '',\r\n    documento: '',\r\n    tipo_documento: 'CC',\r\n    motivo_visita: '',\r\n    contacto: ''\r\n  });\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n  const [success, setSuccess] = useState(null);\r\n  const [qrData, setQrData] = useState(null);\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n    setSuccess(null);\r\n    setQrData(null);\r\n\r\n    try {\r\n      const result = await visitorAPI.create(formData);\r\n      setSuccess(result.message);\r\n      setQrData({\r\n        data: result.qrData,\r\n        code: result.qrCode,\r\n        expiresAt: result.expiresAt,\r\n        nombre: result.visitor?.nombre || formData.nombre,\r\n        motivo_visita: result.visitor?.motivo_visita || formData.motivo_visita,\r\n        contacto: result.visitor?.contacto || formData.contacto\r\n      });\r\n      // Limpiar formulario\r\n      setFormData({\r\n        nombre: '',\r\n        documento: '',\r\n        tipo_documento: 'CC',\r\n        motivo_visita: '',\r\n        contacto: ''\r\n      });\r\n    } catch (err) {\r\n      setError(err.response?.data?.message || 'Error al registrar visitante');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-100 p-4\">\r\n      <div className=\"max-w-4xl mx-auto\">\r\n        <div className=\"bg-white rounded-lg shadow-lg p-6 mb-6\">\r\n          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Registro de Visitantes</h1>\r\n          <p className=\"text-gray-600\">Complete el formulario para generar un código QR temporal (24 horas)</p>\r\n        </div>\r\n\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n          {/* Formulario */}\r\n          <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              {error && (\r\n                <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\r\n                  {error}\r\n                </div>\r\n              )}\r\n\r\n              {success && (\r\n                <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg\">\r\n                  {success}\r\n                </div>\r\n              )}\r\n\r\n              <div>\r\n                <label htmlFor=\"nombre\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Nombre Completo *\r\n                </label>\r\n                <input\r\n                  id=\"nombre\"\r\n                  name=\"nombre\"\r\n                  type=\"text\"\r\n                  value={formData.nombre}\r\n                  onChange={handleChange}\r\n                  required\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                  placeholder=\"Juan Pérez\"\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label htmlFor=\"tipo_documento\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Tipo Documento *\r\n                  </label>\r\n                  <select\r\n                    id=\"tipo_documento\"\r\n                    name=\"tipo_documento\"\r\n                    value={formData.tipo_documento}\r\n                    onChange={handleChange}\r\n                    required\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                  >\r\n                    <option value=\"CC\">Cédula de Ciudadanía</option>\r\n                    <option value=\"CE\">Cédula de Extranjería</option>\r\n                    <option value=\"TI\">Tarjeta de Identidad</option>\r\n                    <option value=\"PA\">Pasaporte</option>\r\n                  </select>\r\n                </div>\r\n\r\n                <div>\r\n                  <label htmlFor=\"documento\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                    Número de Documento *\r\n                  </label>\r\n                  <input\r\n                    id=\"documento\"\r\n                    name=\"documento\"\r\n                    type=\"text\"\r\n                    value={formData.documento}\r\n                    onChange={handleChange}\r\n                    required\r\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                    placeholder=\"1234567890\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"motivo_visita\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Motivo de Visita *\r\n                </label>\r\n                <textarea\r\n                  id=\"motivo_visita\"\r\n                  name=\"motivo_visita\"\r\n                  value={formData.motivo_visita}\r\n                  onChange={handleChange}\r\n                  required\r\n                  rows=\"3\"\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                  placeholder=\"Ej: Reunión con instructor, entrega de documentos...\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label htmlFor=\"contacto\" className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                  Contacto (Teléfono/Email)\r\n                </label>\r\n                <input\r\n                  id=\"contacto\"\r\n                  name=\"contacto\"\r\n                  type=\"text\"\r\n                  value={formData.contacto}\r\n                  onChange={handleChange}\r\n                  className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                  placeholder=\"3001234567 o email@ejemplo.com\"\r\n                />\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                disabled={loading}\r\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center\"\r\n              >\r\n                {loading ? (\r\n                  <>\r\n                    <svg className=\"animate-spin -ml-1 mr-3 h-5 w-5 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\r\n                      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"></path>\r\n                    </svg>\r\n                    Registrando...\r\n                  </>\r\n                ) : (\r\n                  'Registrar Visitante y Generar QR'\r\n                )}\r\n              </button>\r\n            </form>\r\n          </div>\r\n\r\n          {/* QR Code Display */}\r\n          <div className=\"bg-white rounded-lg shadow-lg p-6\">\r\n            <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Código QR Generado</h2>\r\n            {qrData ? (\r\n              <div className=\"text-center\">\r\n                <div className=\"bg-white p-4 rounded-lg border-2 border-blue-500 inline-block mb-4\">\r\n                  <QRCodeSVG value={JSON.stringify(qrData.data)} size={256} />\r\n                </div>\r\n                <p className=\"text-sm text-gray-600 mb-2\">\r\n                  <strong>Válido hasta:</strong> {new Date(qrData.expiresAt).toLocaleString('es-CO')}\r\n                </p>\r\n                <p className=\"text-xs text-gray-500\">\r\n                  Este código QR expirará en 24 horas\r\n                </p>\r\n                <button\r\n                  onClick={() => {\r\n                    const svgElement = document.querySelector('svg');\r\n                    if (!svgElement) return;\r\n\r\n                    const svgData = new XMLSerializer().serializeToString(svgElement);\r\n                    const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });\r\n                    const svgUrl = URL.createObjectURL(svgBlob);\r\n                    const img = new Image();\r\n                    \r\n                    img.onload = () => {\r\n                      // Crear canvas más grande para incluir texto\r\n                      const qrSize = 400; // Tamaño del QR\r\n                      const padding = 40;\r\n                      const textAreaHeight = 200; // Espacio para texto\r\n                      const canvas = document.createElement('canvas');\r\n                      canvas.width = qrSize + (padding * 2);\r\n                      canvas.height = qrSize + textAreaHeight + (padding * 3);\r\n                      \r\n                      const ctx = canvas.getContext('2d');\r\n                      \r\n                      // Fondo blanco\r\n                      ctx.fillStyle = '#ffffff';\r\n                      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n                      \r\n                      // Dibujar QR centrado en la parte superior\r\n                      const qrX = padding;\r\n                      const qrY = padding;\r\n                      ctx.drawImage(img, qrX, qrY, qrSize, qrSize);\r\n                      \r\n                      // Configurar fuente para el texto\r\n                      const textX = canvas.width / 2;\r\n                      let currentY = qrSize + padding * 2;\r\n                      \r\n                      // Estilo del texto\r\n                      ctx.fillStyle = '#1f2937'; // Color gris oscuro\r\n                      ctx.textAlign = 'center';\r\n                      ctx.textBaseline = 'top';\r\n                      \r\n                      // Dibujar información (motivo de visita)\r\n                      if (qrData.motivo_visita) {\r\n                        ctx.font = 'bold 18px Arial, sans-serif';\r\n                        ctx.fillStyle = '#374151';\r\n                        ctx.fillText('Motivo de Visita:', textX, currentY);\r\n                        currentY += 30;\r\n                        \r\n                        ctx.font = '14px Arial, sans-serif';\r\n                        ctx.fillStyle = '#4b5563';\r\n                        // Dividir texto largo en múltiples líneas\r\n                        const motivoLines = wrapText(ctx, qrData.motivo_visita, canvas.width - padding * 2, 14);\r\n                        motivoLines.forEach(line => {\r\n                          ctx.fillText(line, textX, currentY);\r\n                          currentY += 20;\r\n                        });\r\n                        currentY += 10;\r\n                      }\r\n                      \r\n                      // Dibujar nombre\r\n                      if (qrData.nombre) {\r\n                        ctx.font = 'bold 18px Arial, sans-serif';\r\n                        ctx.fillStyle = '#374151';\r\n                        ctx.fillText('Nombre:', textX, currentY);\r\n                        currentY += 30;\r\n                        \r\n                        ctx.font = '16px Arial, sans-serif';\r\n                        ctx.fillStyle = '#1f2937';\r\n                        ctx.fillText(qrData.nombre, textX, currentY);\r\n                        currentY += 30;\r\n                      }\r\n                      \r\n                      // Dibujar contacto\r\n                      if (qrData.contacto) {\r\n                        ctx.font = 'bold 18px Arial, sans-serif';\r\n                        ctx.fillStyle = '#374151';\r\n                        ctx.fillText('Contacto:', textX, currentY);\r\n                        currentY += 30;\r\n                        \r\n                        ctx.font = '16px Arial, sans-serif';\r\n                        ctx.fillStyle = '#1f2937';\r\n                        ctx.fillText(qrData.contacto, textX, currentY);\r\n                      }\r\n                      \r\n                      // Descargar imagen\r\n                      canvas.toBlob((blob) => {\r\n                        const url = URL.createObjectURL(blob);\r\n                        const a = document.createElement('a');\r\n                        a.href = url;\r\n                        a.download = `qr-visitante-${qrData.data.documento}.png`;\r\n                        document.body.appendChild(a);\r\n                        a.click();\r\n                        document.body.removeChild(a);\r\n                        URL.revokeObjectURL(url);\r\n                        URL.revokeObjectURL(svgUrl);\r\n                      }, 'image/png');\r\n                    };\r\n                    \r\n                    img.src = svgUrl;\r\n                  }}\r\n                  className=\"mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-semibold\"\r\n                >\r\n                  Descargar QR\r\n                </button>\r\n              </div>\r\n            ) : (\r\n              <div className=\"text-center py-12 text-gray-400\">\r\n                <svg className=\"w-24 h-24 mx-auto mb-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z\" />\r\n                </svg>\r\n                <p>Complete el formulario para generar el código QR</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Visitors;\r\n"
        }
    ]
}