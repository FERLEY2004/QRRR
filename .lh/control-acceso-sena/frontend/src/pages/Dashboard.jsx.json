{
    "sourceFile": "control-acceso-sena/frontend/src/pages/Dashboard.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1764021641506,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764021785395,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,9 @@\n import { useAuth } from '../context/AuthContext';\n import useDashboard from '../hooks/useDashboard';\n import MetricCard from '../components/MetricCard';\n import CurrentPeopleList from '../components/CurrentPeopleList';\n+import RecentAccessTable from '../components/RecentAccessTable';\n import AlertsPanel from '../components/AlertsPanel';\n \n const Dashboard = () => {\n   const { user } = useAuth();\n@@ -167,8 +168,22 @@\n             />\n           </div>\n         </div>\n \n+        {/* Accesos Recientes */}\n+        <div className=\"mb-6\">\n+          <RecentAccessTable \n+            accesses={data.access || []} \n+            loading={loading}\n+          />\n+          {/* Debug: Mostrar informaci贸n de accesos */}\n+          {process.env.NODE_ENV === 'development' && (\n+            <div className=\"mt-2 text-xs text-gray-400 text-center\">\n+              Debug: {data.access?.length || 0} accesos cargados\n+            </div>\n+          )}\n+        </div>\n+\n         {/* Informaci贸n del Sistema */}\n         <div className=\"bg-white rounded-lg shadow-lg p-6\">\n           <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Informaci贸n del Sistema</h2>\n           <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n"
                },
                {
                    "date": 1764021873806,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,8 @@\n import { useAuth } from '../context/AuthContext';\n import useDashboard from '../hooks/useDashboard';\n import MetricCard from '../components/MetricCard';\n import CurrentPeopleList from '../components/CurrentPeopleList';\n-import RecentAccessTable from '../components/RecentAccessTable';\n import AlertsPanel from '../components/AlertsPanel';\n \n const Dashboard = () => {\n   const { user } = useAuth();\n@@ -168,22 +167,8 @@\n             />\n           </div>\n         </div>\n \n-        {/* Accesos Recientes */}\n-        <div className=\"mb-6\">\n-          <RecentAccessTable \n-            accesses={data.access || []} \n-            loading={loading}\n-          />\n-          {/* Debug: Mostrar informaci贸n de accesos */}\n-          {process.env.NODE_ENV === 'development' && (\n-            <div className=\"mt-2 text-xs text-gray-400 text-center\">\n-              Debug: {data.access?.length || 0} accesos cargados\n-            </div>\n-          )}\n-        </div>\n-\n         {/* Informaci贸n del Sistema */}\n         <div className=\"bg-white rounded-lg shadow-lg p-6\">\n           <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Informaci贸n del Sistema</h2>\n           <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n"
                },
                {
                    "date": 1764100813933,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n import useDashboard from '../hooks/useDashboard';\n import MetricCard from '../components/MetricCard';\n import CurrentPeopleList from '../components/CurrentPeopleList';\n import AlertsPanel from '../components/AlertsPanel';\n+import logo from '../photos/Huella.png';\n \n const Dashboard = () => {\n   const { user } = useAuth();\n   const { data, loading, error, lastUpdate, refresh } = useDashboard();\n@@ -29,11 +30,14 @@\n       <div className=\"max-w-7xl mx-auto\">\n         {/* Header */}\n         <div className=\"mb-6\">\n           <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n-            <div>\n-              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Dashboard de Control de Acceso</h1>\n-              <p className=\"text-gray-600\">Vista en tiempo real del sistema</p>\n+            <div className=\"flex items-center gap-4\">\n+              <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n+              <div>\n+                <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Dashboard de Control de Acceso</h1>\n+                <p className=\"text-gray-600\">Vista en tiempo real del sistema</p>\n+              </div>\n             </div>\n             <div className=\"flex items-center gap-4\">\n               {lastUpdate && (\n                 <div className=\"text-right\">\n"
                },
                {
                    "date": 1764102796105,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,8 @@\n import useDashboard from '../hooks/useDashboard';\n import MetricCard from '../components/MetricCard';\n import CurrentPeopleList from '../components/CurrentPeopleList';\n import AlertsPanel from '../components/AlertsPanel';\n-import logo from '../photos/Huella.png';\n \n const Dashboard = () => {\n   const { user } = useAuth();\n   const { data, loading, error, lastUpdate, refresh } = useDashboard();\n@@ -30,14 +29,11 @@\n       <div className=\"max-w-7xl mx-auto\">\n         {/* Header */}\n         <div className=\"mb-6\">\n           <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n-            <div className=\"flex items-center gap-4\">\n-              <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n-              <div>\n-                <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Dashboard de Control de Acceso</h1>\n-                <p className=\"text-gray-600\">Vista en tiempo real del sistema</p>\n-              </div>\n+            <div>\n+              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Dashboard de Control de Acceso</h1>\n+              <p className=\"text-gray-600\">Vista en tiempo real del sistema</p>\n             </div>\n             <div className=\"flex items-center gap-4\">\n               {lastUpdate && (\n                 <div className=\"text-right\">\n"
                }
            ],
            "date": 1764021641506,
            "name": "Commit-0",
            "content": "// Dashboard Page - Vista en tiempo real completa\nimport React from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport useDashboard from '../hooks/useDashboard';\nimport MetricCard from '../components/MetricCard';\nimport CurrentPeopleList from '../components/CurrentPeopleList';\nimport AlertsPanel from '../components/AlertsPanel';\n\nconst Dashboard = () => {\n  const { user } = useAuth();\n  const { data, loading, error, lastUpdate, refresh } = useDashboard();\n\n  const formatTime = (date) => {\n    if (!date) return 'N/A';\n    return date.toLocaleTimeString('es-CO', { hour: '2-digit', minute: '2-digit', second: '2-digit' });\n  };\n\n  const formatDate = (date) => {\n    if (!date) return 'N/A';\n    return date.toLocaleDateString('es-CO', { \n      day: '2-digit', \n      month: 'long', \n      year: 'numeric' \n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-6\">\n          <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Dashboard de Control de Acceso</h1>\n              <p className=\"text-gray-600\">Vista en tiempo real del sistema</p>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              {lastUpdate && (\n                <div className=\"text-right\">\n                  <p className=\"text-sm text-gray-600\">ltima actualizaci贸n</p>\n                  <p className=\"text-sm font-semibold text-gray-800\">\n                    {formatTime(lastUpdate)}\n                  </p>\n                </div>\n              )}\n              <button\n                onClick={refresh}\n                disabled={loading}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:opacity-50 transition flex items-center gap-2\"\n              >\n                <svg className={`w-5 h-5 ${loading ? 'animate-spin' : ''}`} fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\" />\n                </svg>\n                Actualizar\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Error Message */}\n        {error && (\n          <div className=\"mb-6 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n            <div className=\"flex items-center gap-2\">\n              <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\n              </svg>\n              <p>{error}</p>\n            </div>\n          </div>\n        )}\n\n        {/* M茅tricas Principales */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <MetricCard\n            title=\"Personas Dentro\"\n            value={data.metrics?.currentPeople || 0}\n            icon=\"\"\n            borderColor=\"blue\"\n            loading={loading}\n          />\n          \n          <MetricCard\n            title=\"Accesos Hoy\"\n            value={data.metrics?.todayAccess?.total || 0}\n            icon=\"\"\n            trend={data.metrics?.trendAccess !== undefined \n              ? `${data.metrics.trendAccess >= 0 ? '+' : ''}${data.metrics.trendAccess}% vs ayer`\n              : undefined}\n            borderColor=\"green\"\n            loading={loading}\n          />\n          \n          <MetricCard\n            title=\"Entradas Hoy\"\n            value={data.metrics?.todayAccess?.entradas || 0}\n            icon=\"\"\n            borderColor=\"green\"\n            loading={loading}\n          />\n          \n          <MetricCard\n            title=\"Salidas Hoy\"\n            value={data.metrics?.todayAccess?.salidas || 0}\n            icon=\"\"\n            borderColor=\"orange\"\n            loading={loading}\n          />\n        </div>\n\n        {/* M茅tricas Secundarias */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n          <MetricCard\n            title=\"Visitantes Activos\"\n            value={data.metrics?.activeVisitors || 0}\n            icon=\"\"\n            borderColor=\"purple\"\n            loading={loading}\n          />\n          \n          <MetricCard\n            title=\"Alertas Pendientes\"\n            value={data.metrics?.pendingAlerts || 0}\n            icon=\"锔\"\n            borderColor={data.metrics?.pendingAlerts > 0 ? 'red' : 'yellow'}\n            alert={data.metrics?.pendingAlerts > 0}\n            loading={loading}\n          />\n          \n          <MetricCard\n            title=\"Accesos (7 d铆as)\"\n            value={data.metrics?.statsLast7Days?.total_accesos || 0}\n            icon=\"\"\n            borderColor=\"blue\"\n            loading={loading}\n            trend={data.metrics?.statsLast7Days?.personas_unicas \n              ? `${data.metrics.statsLast7Days.personas_unicas} personas 煤nicas`\n              : undefined}\n          />\n          \n          <MetricCard\n            title=\"Tiempo Promedio\"\n            value={data.metrics?.statsLast7Days?.tiempo_promedio_minutos \n              ? `${Math.floor(data.metrics.statsLast7Days.tiempo_promedio_minutos / 60)}h ${data.metrics.statsLast7Days.tiempo_promedio_minutos % 60}m`\n              : 'N/A'}\n            icon=\"憋\"\n            borderColor=\"purple\"\n            loading={loading}\n          />\n        </div>\n\n        {/* Contenido Principal */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6\">\n          {/* Personas Dentro - Ocupa 2 columnas */}\n          <div className=\"lg:col-span-2\">\n            <CurrentPeopleList \n              people={data.people} \n              loading={loading} \n              onRefresh={refresh}\n            />\n          </div>\n\n          {/* Alertas - Ocupa 1 columna */}\n          <div className=\"lg:col-span-1\">\n            <AlertsPanel \n              alerts={data.alerts} \n              loading={loading}\n            />\n          </div>\n        </div>\n\n        {/* Informaci贸n del Sistema */}\n        <div className=\"bg-white rounded-lg shadow-lg p-6\">\n          <h2 className=\"text-xl font-bold text-gray-800 mb-4\">Informaci贸n del Sistema</h2>\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n            <div className=\"p-4 bg-blue-50 rounded-lg\">\n              <p className=\"text-sm text-gray-600 mb-1\">Usuario Actual</p>\n              <p className=\"text-lg font-semibold text-gray-800\">{user?.nombre || 'N/A'}</p>\n              <p className=\"text-xs text-gray-500 mt-1\">{user?.email || 'N/A'}</p>\n            </div>\n            \n            <div className=\"p-4 bg-green-50 rounded-lg\">\n              <p className=\"text-sm text-gray-600 mb-1\">Rol</p>\n              <p className=\"text-lg font-semibold text-gray-800 capitalize\">\n                {(user?.rol?.toUpperCase() === 'ADMIN' || user?.rol?.toUpperCase() === 'ADMINISTRADOR') \n                  ? 'Administrador' \n                  : user?.rol?.toUpperCase() === 'GUARDA' \n                    ? 'Guarda de Seguridad' \n                    : 'N/A'}\n              </p>\n            </div>\n\n            <div className=\"p-4 bg-purple-50 rounded-lg\">\n              <p className=\"text-sm text-gray-600 mb-1\">Estado del Sistema</p>\n              <div className=\"flex items-center gap-2 mt-2\">\n                <div className={`w-3 h-3 rounded-full ${error ? 'bg-red-500' : 'bg-green-500'} ${!error ? 'animate-pulse' : ''}`}></div>\n                <p className=\"text-sm font-medium text-gray-800\">\n                  {error ? 'Error de conexi贸n' : 'Operativo'}\n                </p>\n              </div>\n              {lastUpdate && (\n                <p className=\"text-xs text-gray-500 mt-2\">\n                  Actualizado: {formatTime(lastUpdate)}\n                </p>\n              )}\n            </div>\n          </div>\n          \n          {data.metrics?.outOfScheduleAccess > 0 && (\n            <div className=\"mt-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg\">\n              <div className=\"flex items-center gap-2\">\n                <svg className=\"w-5 h-5 text-yellow-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n                </svg>\n                <p className=\"text-sm font-medium text-yellow-800\">\n                  {data.metrics.outOfScheduleAccess} acceso(s) fuera de horario detectado(s) hoy\n                </p>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Dashboard;\n"
        }
    ]
}