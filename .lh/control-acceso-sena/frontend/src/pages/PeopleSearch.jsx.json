{
    "sourceFile": "control-acceso-sena/frontend/src/pages/PeopleSearch.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1764100813885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764102796110,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,8 @@\n import React, { useState, useCallback, useRef } from 'react';\n import { useSearch } from '../hooks/useSearch.js';\n import AdvancedFilters from '../components/reports/AdvancedFilters.jsx';\n import DataTable from '../components/reports/DataTable.jsx';\n-import logo from '../photos/Huella.png';\n \n const PeopleSearch = () => {\n   const [searchQuery, setSearchQuery] = useState('');\n   const { results, loading, error, filters, pagination, updateFilters, performSearch, changePage, clearFilters } = useSearch('users');\n@@ -71,15 +70,10 @@\n     <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n       <div className=\"max-w-7xl mx-auto\">\n         {/* Header */}\n         <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n-          <div className=\"flex items-center gap-4\">\n-            <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n-            <div>\n-              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Búsqueda de Usuarios</h1>\n-              <p className=\"text-gray-600\">Busca usuarios por documento, nombre, email o cualquier campo</p>\n-            </div>\n-          </div>\n+          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Búsqueda de Usuarios</h1>\n+          <p className=\"text-gray-600\">Busca usuarios por documento, nombre, email o cualquier campo</p>\n         </div>\n \n         {/* Barra de búsqueda */}\n         <div className=\"bg-white rounded-lg shadow-md p-4 mb-6\">\n"
                },
                {
                    "date": 1764228105358,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,8 +58,10 @@\n   const columns = [\n     { key: 'documento', label: 'Documento' },\n     { key: 'nombre_completo', label: 'Nombre Completo' },\n     { key: 'email', label: 'Email' },\n+    { key: 'programa', label: 'Programa' },\n+    { key: 'ficha', label: 'Ficha' },\n     { key: 'telefono', label: 'Teléfono' },\n     { key: 'rol', label: 'Rol' },\n     { key: 'estado', label: 'Estado' },\n     { key: 'fecha_registro', label: 'Fecha Registro' },\n"
                }
            ],
            "date": 1764100813885,
            "name": "Commit-0",
            "content": "// PeopleSearch - Búsqueda avanzada de usuarios\nimport React, { useState, useCallback, useRef } from 'react';\nimport { useSearch } from '../hooks/useSearch.js';\nimport AdvancedFilters from '../components/reports/AdvancedFilters.jsx';\nimport DataTable from '../components/reports/DataTable.jsx';\nimport logo from '../photos/Huella.png';\n\nconst PeopleSearch = () => {\n  const [searchQuery, setSearchQuery] = useState('');\n  const { results, loading, error, filters, pagination, updateFilters, performSearch, changePage, clearFilters } = useSearch('users');\n  \n  // Refs para mantener valores actuales sin causar re-renders\n  const filtersRef = useRef(filters);\n  const searchQueryRef = useRef(searchQuery);\n  \n  filtersRef.current = filters;\n  searchQueryRef.current = searchQuery;\n\n  const handleSearch = useCallback(() => {\n    const currentFilters = filtersRef.current;\n    const currentQuery = searchQueryRef.current;\n    \n    if (!currentQuery.trim() && Object.keys(currentFilters).length === 0) {\n      // Si no hay búsqueda ni filtros, no hacer nada\n      return;\n    }\n    \n    const searchFilters = currentQuery.trim() \n      ? { ...currentFilters, query: currentQuery.trim() }\n      : { ...currentFilters };\n    \n    // Remover query vacío si existe\n    if (searchFilters.query === '') {\n      delete searchFilters.query;\n    }\n    \n    updateFilters(searchFilters);\n    performSearch(searchFilters, 1);\n  }, [updateFilters, performSearch]);\n\n  const handleFilterChange = useCallback((newFilters) => {\n    const currentFilters = filtersRef.current;\n    const currentQuery = searchQueryRef.current;\n    \n    const updatedFilters = { ...currentFilters, ...newFilters };\n    // Mantener query si existe\n    if (currentQuery.trim()) {\n      updatedFilters.query = currentQuery.trim();\n    }\n    updateFilters(updatedFilters);\n    performSearch(updatedFilters, 1);\n  }, [updateFilters, performSearch]);\n\n  const handleClearSearch = () => {\n    setSearchQuery('');\n    clearFilters();\n  };\n\n  const columns = [\n    { key: 'documento', label: 'Documento' },\n    { key: 'nombre_completo', label: 'Nombre Completo' },\n    { key: 'email', label: 'Email' },\n    { key: 'telefono', label: 'Teléfono' },\n    { key: 'rol', label: 'Rol' },\n    { key: 'estado', label: 'Estado' },\n    { key: 'fecha_registro', label: 'Fecha Registro' },\n    { key: 'ultimo_acceso', label: 'Último Acceso' }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n          <div className=\"flex items-center gap-4\">\n            <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Búsqueda de Usuarios</h1>\n              <p className=\"text-gray-600\">Busca usuarios por documento, nombre, email o cualquier campo</p>\n            </div>\n          </div>\n        </div>\n\n        {/* Barra de búsqueda */}\n        <div className=\"bg-white rounded-lg shadow-md p-4 mb-6\">\n          <div className=\"flex gap-4\">\n            <input\n              type=\"text\"\n              placeholder=\"Buscar por documento, nombre, email...\"\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              onKeyPress={(e) => {\n                if (e.key === 'Enter') {\n                  handleSearch();\n                }\n              }}\n              className=\"flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none\"\n            />\n            <button\n              onClick={handleSearch}\n              disabled={loading}\n              className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed text-white rounded-lg font-semibold transition-colors\"\n            >\n              {loading ? 'Buscando...' : 'Buscar'}\n            </button>\n            {(searchQuery || Object.keys(filters).length > 0) && (\n              <button\n                onClick={handleClearSearch}\n                className=\"px-4 py-2 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-semibold transition-colors\"\n              >\n                Limpiar\n              </button>\n            )}\n          </div>\n        </div>\n\n        {/* Filtros avanzados */}\n        <AdvancedFilters\n          onFilter={handleFilterChange}\n          availableFilters={['rol', 'estado', 'documento', 'nombre', 'email']}\n          initialFilters={filters}\n        />\n\n        {/* Resultados */}\n        {results && (\n          <div className=\"bg-white rounded-lg shadow-md p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h2 className=\"text-xl font-semibold text-gray-800\">\n                Resultados de Búsqueda\n              </h2>\n              {pagination && (\n                <span className=\"text-sm text-gray-600\">\n                  {pagination.total} resultado{pagination.total !== 1 ? 's' : ''} encontrado{pagination.total !== 1 ? 's' : ''}\n                </span>\n              )}\n            </div>\n\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\n                {error}\n              </div>\n            )}\n\n            <DataTable\n              data={results.data || []}\n              columns={columns}\n              pagination={pagination}\n              onPageChange={changePage}\n              loading={loading}\n              emptyMessage=\"No se encontraron usuarios con los criterios de búsqueda\"\n            />\n          </div>\n        )}\n\n        {!results && !loading && (\n          <div className=\"bg-white rounded-lg shadow-md p-8 text-center\">\n            <p className=\"text-gray-500 text-lg\">Ingresa un término de búsqueda para comenzar</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default PeopleSearch;\n\n\n"
        }
    ]
}