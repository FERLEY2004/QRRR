{
    "sourceFile": "control-acceso-sena/frontend/src/pages/AccessHistory.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1764100813867,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764104823176,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,25 +1,27 @@\n // AccessHistory - Historial de accesos\r\n-import React, { useState } from 'react';\r\n+import React, { useState, useCallback, useRef } from 'react';\r\n import { useReports } from '../hooks/useReports.js';\r\n import AdvancedFilters from '../components/reports/AdvancedFilters.jsx';\r\n import DataTable from '../components/reports/DataTable.jsx';\r\n import ExportButtons from '../components/reports/ExportButtons.jsx';\r\n-import logo from '../photos/Huella.png';\r\n \r\n const AccessHistory = () => {\r\n-  const [filters, setFilters] = useState({\r\n+  const initialFilters = {\r\n     fecha_desde: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n     fecha_hasta: new Date().toISOString().split('T')[0]\r\n-  });\r\n+  };\r\n \r\n-  const { data, loading, error, updateFilters, refresh } = useReports('access-history', filters);\r\n+  const [filters, setFilters] = useState(initialFilters);\r\n+  const { data, loading, error, updateFilters, refresh } = useReports('access-history', initialFilters);\r\n+  const filtersRef = useRef(initialFilters);\r\n \r\n-  const handleFilterChange = (newFilters) => {\r\n-    const updatedFilters = { ...filters, ...newFilters };\r\n+  const handleFilterChange = useCallback((newFilters) => {\r\n+    const updatedFilters = { ...filtersRef.current, ...newFilters };\r\n+    filtersRef.current = updatedFilters;\r\n     setFilters(updatedFilters);\r\n     updateFilters(updatedFilters);\r\n-  };\r\n+  }, [updateFilters]);\r\n \r\n   const handlePageChange = (page) => {\r\n     updateFilters({ ...filters, page });\r\n   };\r\n@@ -41,14 +43,11 @@\n       <div className=\"max-w-7xl mx-auto\">\r\n         {/* Header */}\r\n         <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\r\n           <div className=\"flex items-center justify-between\">\r\n-            <div className=\"flex items-center gap-4\">\r\n-              <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\r\n-              <div>\r\n-                <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Historial de Accesos</h1>\r\n-                <p className=\"text-gray-600\">Consulta el historial completo de accesos al sistema</p>\r\n-              </div>\r\n+            <div>\r\n+              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Historial de Accesos</h1>\r\n+              <p className=\"text-gray-600\">Consulta el historial completo de accesos al sistema</p>\r\n             </div>\r\n             <ExportButtons\r\n               reportType=\"access-history\"\r\n               filters={filters}\r\n"
                },
                {
                    "date": 1764108083205,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,116 +1,116 @@\n-// AccessHistory - Historial de accesos\r\n-import React, { useState, useCallback, useRef } from 'react';\r\n-import { useReports } from '../hooks/useReports.js';\r\n-import AdvancedFilters from '../components/reports/AdvancedFilters.jsx';\r\n-import DataTable from '../components/reports/DataTable.jsx';\r\n-import ExportButtons from '../components/reports/ExportButtons.jsx';\r\n-\r\n-const AccessHistory = () => {\r\n-  const initialFilters = {\r\n-    fecha_desde: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n-    fecha_hasta: new Date().toISOString().split('T')[0]\r\n-  };\r\n-\r\n-  const [filters, setFilters] = useState(initialFilters);\r\n-  const { data, loading, error, updateFilters, refresh } = useReports('access-history', initialFilters);\r\n-  const filtersRef = useRef(initialFilters);\r\n-\r\n-  const handleFilterChange = useCallback((newFilters) => {\r\n-    const updatedFilters = { ...filtersRef.current, ...newFilters };\r\n-    filtersRef.current = updatedFilters;\r\n-    setFilters(updatedFilters);\r\n-    updateFilters(updatedFilters);\r\n-  }, [updateFilters]);\r\n-\r\n-  const handlePageChange = (page) => {\r\n-    updateFilters({ ...filters, page });\r\n-  };\r\n-\r\n-  const columns = [\r\n-    { key: 'documento', label: 'Documento' },\r\n-    { key: 'nombre_completo', label: 'Nombre' },\r\n-    { key: 'rol', label: 'Rol' },\r\n-    { key: 'tipo_acceso', label: 'Tipo' },\r\n-    { key: 'fecha_entrada', label: 'Fecha Entrada' },\r\n-    { key: 'fecha_salida', label: 'Fecha Salida' },\r\n-    { key: 'duracion_minutos', label: 'Duración (min)' },\r\n-    { key: 'estado', label: 'Estado' },\r\n-    { key: 'registrado_por', label: 'Registrado Por' }\r\n-  ];\r\n-\r\n-  return (\r\n-    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\r\n-      <div className=\"max-w-7xl mx-auto\">\r\n-        {/* Header */}\r\n-        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\r\n-          <div className=\"flex items-center justify-between\">\r\n-            <div>\r\n-              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Historial de Accesos</h1>\r\n-              <p className=\"text-gray-600\">Consulta el historial completo de accesos al sistema</p>\r\n-            </div>\r\n-            <ExportButtons\r\n-              reportType=\"access-history\"\r\n-              filters={filters}\r\n-              data={data}\r\n-            />\r\n-          </div>\r\n-        </div>\r\n-\r\n-        {/* Filtros */}\r\n-        <AdvancedFilters\r\n-          onFilter={handleFilterChange}\r\n-          availableFilters={['fecha_desde', 'fecha_hasta', 'documento', 'rol', 'tipo_acceso']}\r\n-          initialFilters={filters}\r\n-        />\r\n-\r\n-        {/* Resumen */}\r\n-        {data && data.pagination && (\r\n-          <div className=\"bg-white rounded-lg shadow-md p-4 mb-6\">\r\n-            <div className=\"flex items-center justify-between\">\r\n-              <div>\r\n-                <p className=\"text-sm text-gray-600\">Total de registros</p>\r\n-                <p className=\"text-2xl font-bold text-gray-800\">{data.pagination.total}</p>\r\n-              </div>\r\n-              <button\r\n-                onClick={refresh}\r\n-                className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold\"\r\n-              >\r\n-                Actualizar\r\n-              </button>\r\n-            </div>\r\n-          </div>\r\n-        )}\r\n-\r\n-        {/* Tabla de datos */}\r\n-        <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n-          {error && (\r\n-            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\r\n-              {error}\r\n-            </div>\r\n-          )}\r\n-\r\n-          <DataTable\r\n-            data={data?.data || []}\r\n-            columns={columns}\r\n-            pagination={data?.pagination}\r\n-            onPageChange={handlePageChange}\r\n-            loading={loading}\r\n-            emptyMessage=\"No hay registros de acceso para los filtros seleccionados\"\r\n-          />\r\n-        </div>\r\n-      </div>\r\n-    </div>\r\n-  );\r\n-};\r\n-\r\n-export default AccessHistory;\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n+// AccessHistory - Historial de accesos\n+import React, { useState, useCallback, useRef } from 'react';\n+import { useReports } from '../hooks/useReports.js';\n+import AdvancedFilters from '../components/reports/AdvancedFilters.jsx';\n+import DataTable from '../components/reports/DataTable.jsx';\n+import ExportButtons from '../components/reports/ExportButtons.jsx';\n+\n+const AccessHistory = () => {\n+  const initialFilters = {\n+    fecha_desde: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\n+    fecha_hasta: new Date().toISOString().split('T')[0]\n+  };\n+\n+  const [filters, setFilters] = useState(initialFilters);\n+  const { data, loading, error, updateFilters, refresh } = useReports('access-history', initialFilters);\n+  const filtersRef = useRef(initialFilters);\n+\n+  const handleFilterChange = useCallback((newFilters) => {\n+    const updatedFilters = { ...filtersRef.current, ...newFilters };\n+    filtersRef.current = updatedFilters;\n+    setFilters(updatedFilters);\n+    updateFilters(updatedFilters);\n+  }, [updateFilters]);\n+\n+  const handlePageChange = (page) => {\n+    updateFilters({ ...filters, page });\n+  };\n+\n+  const columns = [\n+    { key: 'documento', label: 'Documento' },\n+    { key: 'nombre_completo', label: 'Nombre' },\n+    { key: 'rol', label: 'Rol' },\n+    { key: 'tipo_acceso', label: 'Tipo' },\n+    { key: 'fecha_entrada', label: 'Fecha Entrada' },\n+    { key: 'fecha_salida', label: 'Fecha Salida' },\n+    { key: 'duracion_minutos', label: 'Duración (min)' },\n+    { key: 'estado', label: 'Estado' },\n+    { key: 'registrado_por', label: 'Registrado Por' }\n+  ];\n+\n+  return (\n+    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n+      <div className=\"max-w-7xl mx-auto\">\n+        {/* Header */}\n+        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\n+          <div className=\"flex items-center justify-between\">\n+            <div>\n+              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Historial de Accesos</h1>\n+              <p className=\"text-gray-600\">Consulta el historial completo de accesos al sistema</p>\n+            </div>\n+            <ExportButtons\n+              reportType=\"access-history\"\n+              filters={filters}\n+              data={data}\n+            />\n+          </div>\n+        </div>\n+\n+        {/* Filtros */}\n+        <AdvancedFilters\n+          onFilter={handleFilterChange}\n+          availableFilters={['fecha_desde', 'fecha_hasta', 'documento', 'rol', 'tipo_acceso']}\n+          initialFilters={filters}\n+        />\n+\n+        {/* Resumen */}\n+        {data && data.pagination && (\n+          <div className=\"bg-white rounded-lg shadow-md p-4 mb-6\">\n+            <div className=\"flex items-center justify-between\">\n+              <div>\n+                <p className=\"text-sm text-gray-600\">Total de registros</p>\n+                <p className=\"text-2xl font-bold text-gray-800\">{data.pagination.total}</p>\n+              </div>\n+              <button\n+                onClick={refresh}\n+                className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold\"\n+              >\n+                Actualizar\n+              </button>\n+            </div>\n+          </div>\n+        )}\n+\n+        {/* Tabla de datos */}\n+        <div className=\"bg-white rounded-lg shadow-md p-6\">\n+          {error && (\n+            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\n+              {error}\n+            </div>\n+          )}\n+\n+          <DataTable\n+            data={data?.data || []}\n+            columns={columns}\n+            pagination={data?.pagination}\n+            onPageChange={handlePageChange}\n+            loading={loading}\n+            emptyMessage=\"No hay registros de acceso para los filtros seleccionados\"\n+          />\n+        </div>\n+      </div>\n+    </div>\n+  );\n+};\n+\n+export default AccessHistory;\n+\n+\n+\n+\n+\n+\n+\n+\n+\n+\n"
                },
                {
                    "date": 1764109099679,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,12 +15,15 @@\n   const { data, loading, error, updateFilters, refresh } = useReports('access-history', initialFilters);\n   const filtersRef = useRef(initialFilters);\n \n   const handleFilterChange = useCallback((newFilters) => {\n-    const updatedFilters = { ...filtersRef.current, ...newFilters };\n-    filtersRef.current = updatedFilters;\n-    setFilters(updatedFilters);\n-    updateFilters(updatedFilters);\n+    // Usar setTimeout para evitar actualizar durante el renderizado\n+    setTimeout(() => {\n+      const updatedFilters = { ...filtersRef.current, ...newFilters };\n+      filtersRef.current = updatedFilters;\n+      setFilters(updatedFilters);\n+      updateFilters(updatedFilters);\n+    }, 0);\n   }, [updateFilters]);\n \n   const handlePageChange = (page) => {\n     updateFilters({ ...filters, page });\n"
                }
            ],
            "date": 1764100813867,
            "name": "Commit-0",
            "content": "// AccessHistory - Historial de accesos\r\nimport React, { useState } from 'react';\r\nimport { useReports } from '../hooks/useReports.js';\r\nimport AdvancedFilters from '../components/reports/AdvancedFilters.jsx';\r\nimport DataTable from '../components/reports/DataTable.jsx';\r\nimport ExportButtons from '../components/reports/ExportButtons.jsx';\r\nimport logo from '../photos/Huella.png';\r\n\r\nconst AccessHistory = () => {\r\n  const [filters, setFilters] = useState({\r\n    fecha_desde: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],\r\n    fecha_hasta: new Date().toISOString().split('T')[0]\r\n  });\r\n\r\n  const { data, loading, error, updateFilters, refresh } = useReports('access-history', filters);\r\n\r\n  const handleFilterChange = (newFilters) => {\r\n    const updatedFilters = { ...filters, ...newFilters };\r\n    setFilters(updatedFilters);\r\n    updateFilters(updatedFilters);\r\n  };\r\n\r\n  const handlePageChange = (page) => {\r\n    updateFilters({ ...filters, page });\r\n  };\r\n\r\n  const columns = [\r\n    { key: 'documento', label: 'Documento' },\r\n    { key: 'nombre_completo', label: 'Nombre' },\r\n    { key: 'rol', label: 'Rol' },\r\n    { key: 'tipo_acceso', label: 'Tipo' },\r\n    { key: 'fecha_entrada', label: 'Fecha Entrada' },\r\n    { key: 'fecha_salida', label: 'Fecha Salida' },\r\n    { key: 'duracion_minutos', label: 'Duración (min)' },\r\n    { key: 'estado', label: 'Estado' },\r\n    { key: 'registrado_por', label: 'Registrado Por' }\r\n  ];\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\r\n      <div className=\"max-w-7xl mx-auto\">\r\n        {/* Header */}\r\n        <div className=\"bg-white rounded-lg shadow-md p-6 mb-6\">\r\n          <div className=\"flex items-center justify-between\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\r\n              <div>\r\n                <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Historial de Accesos</h1>\r\n                <p className=\"text-gray-600\">Consulta el historial completo de accesos al sistema</p>\r\n              </div>\r\n            </div>\r\n            <ExportButtons\r\n              reportType=\"access-history\"\r\n              filters={filters}\r\n              data={data}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Filtros */}\r\n        <AdvancedFilters\r\n          onFilter={handleFilterChange}\r\n          availableFilters={['fecha_desde', 'fecha_hasta', 'documento', 'rol', 'tipo_acceso']}\r\n          initialFilters={filters}\r\n        />\r\n\r\n        {/* Resumen */}\r\n        {data && data.pagination && (\r\n          <div className=\"bg-white rounded-lg shadow-md p-4 mb-6\">\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <p className=\"text-sm text-gray-600\">Total de registros</p>\r\n                <p className=\"text-2xl font-bold text-gray-800\">{data.pagination.total}</p>\r\n              </div>\r\n              <button\r\n                onClick={refresh}\r\n                className=\"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-semibold\"\r\n              >\r\n                Actualizar\r\n              </button>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Tabla de datos */}\r\n        <div className=\"bg-white rounded-lg shadow-md p-6\">\r\n          {error && (\r\n            <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-4\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <DataTable\r\n            data={data?.data || []}\r\n            columns={columns}\r\n            pagination={data?.pagination}\r\n            onPageChange={handlePageChange}\r\n            loading={loading}\r\n            emptyMessage=\"No hay registros de acceso para los filtros seleccionados\"\r\n          />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AccessHistory;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n"
        }
    ]
}