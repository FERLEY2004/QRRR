{
    "sourceFile": "control-acceso-sena/frontend/src/pages/AdminPanel.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1764016711161,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764100813927,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n import React, { useState, useEffect } from 'react';\n import { userAPI } from '../services/api.js';\n import { useAuth } from '../context/AuthContext.jsx';\n import SystemConfig from '../components/SystemConfig.jsx';\n+import logo from '../photos/Huella.png';\n \n const AdminPanel = () => {\n   const [activeTab, setActiveTab] = useState('users');\n   const [users, setUsers] = useState([]);\n@@ -187,10 +188,15 @@\n     <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n       <div className=\"max-w-7xl mx-auto\">\n         {/* Header */}\n         <div className=\"mb-6\">\n-          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Gestión de Usuarios</h1>\n-          <p className=\"text-gray-600\">Gestión completa del sistema</p>\n+          <div className=\"flex items-center gap-4\">\n+            <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n+            <div>\n+              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Gestión de Usuarios</h1>\n+              <p className=\"text-gray-600\">Gestión completa del sistema</p>\n+            </div>\n+          </div>\n         </div>\n \n         {/* Tabs */}\n         <div className=\"bg-white rounded-lg shadow-lg mb-6\">\n"
                },
                {
                    "date": 1764102796068,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,9 +2,8 @@\n import React, { useState, useEffect } from 'react';\n import { userAPI } from '../services/api.js';\n import { useAuth } from '../context/AuthContext.jsx';\n import SystemConfig from '../components/SystemConfig.jsx';\n-import logo from '../photos/Huella.png';\n \n const AdminPanel = () => {\n   const [activeTab, setActiveTab] = useState('users');\n   const [users, setUsers] = useState([]);\n@@ -188,15 +187,10 @@\n     <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n       <div className=\"max-w-7xl mx-auto\">\n         {/* Header */}\n         <div className=\"mb-6\">\n-          <div className=\"flex items-center gap-4\">\n-            <img src={logo} alt=\"Logo SENA\" className=\"h-12 w-12 object-contain\" />\n-            <div>\n-              <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Gestión de Usuarios</h1>\n-              <p className=\"text-gray-600\">Gestión completa del sistema</p>\n-            </div>\n-          </div>\n+          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Gestión de Usuarios</h1>\n+          <p className=\"text-gray-600\">Gestión completa del sistema</p>\n         </div>\n \n         {/* Tabs */}\n         <div className=\"bg-white rounded-lg shadow-lg mb-6\">\n"
                },
                {
                    "date": 1764233790000,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,10 +1,56 @@\n // Admin Panel - Gestión completa del sistema\n import React, { useState, useEffect } from 'react';\n-import { userAPI } from '../services/api.js';\n+import { userAPI, catalogAPI } from '../services/api.js';\n import { useAuth } from '../context/AuthContext.jsx';\n import SystemConfig from '../components/SystemConfig.jsx';\n \n+const isDigitString = (value) => /^\\d+$/.test(value);\n+\n+const isSequentialDigits = (value) => {\n+  if (!isDigitString(value) || value.length < 2) {\n+    return false;\n+  }\n+\n+  let ascending = true;\n+  let descending = true;\n+\n+  for (let i = 1; i < value.length; i++) {\n+    const prev = parseInt(value[i - 1], 10);\n+    const current = parseInt(value[i], 10);\n+    const diff = current - prev;\n+    if (diff !== 1) ascending = false;\n+    if (diff !== -1) descending = false;\n+  }\n+\n+  return ascending || descending;\n+};\n+\n+const isRepeatedDigit = (value) => {\n+  if (!isDigitString(value) || value.length < 8) {\n+    return false;\n+  }\n+\n+  const uniqueDigits = new Set(value.split(''));\n+  return uniqueDigits.size === 1;\n+};\n+\n+const getPasswordValidationError = (password) => {\n+  if (!password) {\n+    return 'La contraseña es requerida';\n+  }\n+  if (password.length < 8) {\n+    return 'La contraseña debe tener al menos 8 caracteres';\n+  }\n+  if (isDigitString(password) && isSequentialDigits(password)) {\n+    return 'No puedes usar una secuencia numérica consecutiva como contraseña';\n+  }\n+  if (isRepeatedDigit(password)) {\n+    return 'No puedes repetir el mismo número ocho veces o más';\n+  }\n+  return null;\n+};\n+\n const AdminPanel = () => {\n   const [activeTab, setActiveTab] = useState('users');\n   const [users, setUsers] = useState([]);\n   const [filteredUsers, setFilteredUsers] = useState([]);\n@@ -19,16 +65,33 @@\n   const [formData, setFormData] = useState({\n     nombre: '',\n     email: '',\n     password: '',\n+    passwordConfirm: '',\n+    currentPassword: '',\n     rol: 'GUARDA',\n     estado: 'ACTIVO'\n   });\n   const { user } = useAuth();\n+  const [catalogPrograms, setCatalogPrograms] = useState([]);\n+  const [fichaForm, setFichaForm] = useState({\n+    codigo_ficha: '',\n+    codigo_programa: '',\n+    jornada: 'diurna',\n+    fecha_inicio: '',\n+    fecha_fin: '',\n+    estado: 'activa',\n+    numero_aprendices: 0,\n+    capacidad_maxima: '',\n+    descripcion: ''\n+  });\n+  const [fichaFeedback, setFichaFeedback] = useState(null);\n \n   useEffect(() => {\n     if (activeTab === 'users') {\n       loadUsers();\n+    } else if (activeTab === 'catalog') {\n+      loadCatalogPrograms();\n     }\n   }, [activeTab]);\n \n   useEffect(() => {\n@@ -78,8 +141,61 @@\n       setLoading(false);\n     }\n   };\n \n+  const loadCatalogPrograms = async () => {\n+    try {\n+      const response = await catalogAPI.getAllPrograms({ estado: 'activo' });\n+      if (response.success) {\n+        setCatalogPrograms(response.data || []);\n+      }\n+    } catch (err) {\n+      console.error('Error cargando programas del catálogo:', err);\n+    }\n+  };\n+\n+  const handleFichaFormChange = (field, value) => {\n+    setFichaForm(prev => ({\n+      ...prev,\n+      [field]: value\n+    }));\n+  };\n+\n+  const handleFichaFormSubmit = async (event) => {\n+    event.preventDefault();\n+    setFichaFeedback({ type: 'info', message: 'Guardando ficha...' });\n+    try {\n+      const payload = {\n+        ...fichaForm,\n+        numero_aprendices: Number(fichaForm.numero_aprendices) || 0\n+      };\n+      const result = await catalogAPI.createFicha(payload);\n+      if (result.success) {\n+        setFichaFeedback({ type: 'success', message: 'Ficha creada exitosamente' });\n+        setFichaForm({\n+          codigo_ficha: '',\n+          codigo_programa: '',\n+          jornada: 'diurna',\n+          fecha_inicio: '',\n+          fecha_fin: '',\n+          estado: 'activa',\n+          numero_aprendices: 0,\n+          capacidad_maxima: ''\n+        });\n+        loadCatalogPrograms();\n+      } else {\n+        setFichaFeedback({ type: 'error', message: result.message || 'No se pudo crear la ficha' });\n+      }\n+    } catch (error) {\n+      console.error('Error creando ficha:', error);\n+      setFichaFeedback({\n+        type: 'error',\n+        message: error.response?.data?.message || 'Error al crear la ficha'\n+      });\n+    }\n+    setTimeout(() => setFichaFeedback(null), 4000);\n+  };\n+\n   const handleInputChange = (e) => {\n     setFormData({\n       ...formData,\n       [e.target.name]: e.target.value\n@@ -91,25 +207,65 @@\n     setError('');\n     setSuccess('');\n     setLoading(true);\n \n+    const isEditingSelf = editingUser && editingUser.id_usuario === user?.id;\n+\n     try {\n       if (editingUser) {\n-        // Actualizar usuario\n-        const updateData = { ...formData };\n-        if (!updateData.password) {\n-          delete updateData.password;\n+        if (formData.password) {\n+          if (formData.password !== formData.passwordConfirm) {\n+            setError('La contraseña y su confirmación no coinciden');\n+            return;\n+          }\n+          const passwordError = getPasswordValidationError(formData.password);\n+          if (passwordError) {\n+            setError(passwordError);\n+            return;\n+          }\n+          if (isEditingSelf && !formData.currentPassword) {\n+            setError('Debes indicar tu contraseña actual para cambiarla');\n+            return;\n+          }\n         }\n+\n+        const updateData = {\n+          nombre: formData.nombre,\n+          email: formData.email,\n+          rol: formData.rol,\n+          estado: formData.estado\n+        };\n+        if (formData.password) {\n+          updateData.password = formData.password;\n+          if (isEditingSelf) {\n+            updateData.currentPassword = formData.currentPassword;\n+          }\n+        }\n+\n         await userAPI.update(editingUser.id_usuario, updateData);\n         setSuccess('Usuario actualizado exitosamente');\n       } else {\n-        // Crear usuario\n         if (!formData.password) {\n           setError('La contraseña es requerida para nuevos usuarios');\n-          setLoading(false);\n           return;\n         }\n-        await userAPI.create(formData);\n+        if (formData.password !== formData.passwordConfirm) {\n+          setError('La contraseña y su confirmación no coinciden');\n+          return;\n+        }\n+        const passwordError = getPasswordValidationError(formData.password);\n+        if (passwordError) {\n+          setError(passwordError);\n+          return;\n+        }\n+\n+        await userAPI.create({\n+          nombre: formData.nombre,\n+          email: formData.email,\n+          password: formData.password,\n+          rol: formData.rol,\n+          estado: formData.estado\n+        });\n         setSuccess('Usuario creado exitosamente');\n       }\n       \n       setShowUserForm(false);\n@@ -117,8 +273,10 @@\n       setFormData({\n         nombre: '',\n         email: '',\n         password: '',\n+        passwordConfirm: '',\n+        currentPassword: '',\n         rol: 'GUARDA',\n         estado: 'ACTIVO'\n       });\n       loadUsers();\n@@ -134,8 +292,10 @@\n     setFormData({\n       nombre: userToEdit.nombre,\n       email: userToEdit.email,\n       password: '',\n+      passwordConfirm: '',\n+      currentPassword: '',\n       rol: userToEdit.rol,\n       estado: userToEdit.estado\n     });\n     setShowUserForm(true);\n@@ -177,10 +337,12 @@\n     setFormData({\n       nombre: '',\n       email: '',\n       password: '',\n-      rol: 'guarda',\n-      estado: 'activo'\n+      passwordConfirm: '',\n+      currentPassword: '',\n+      rol: 'GUARDA',\n+      estado: 'ACTIVO'\n     });\n   };\n \n   return (\n@@ -195,28 +357,38 @@\n         {/* Tabs */}\n         <div className=\"bg-white rounded-lg shadow-lg mb-6\">\n           <div className=\"border-b border-gray-200\">\n             <nav className=\"flex -mb-px\">\n-              <button\n-                onClick={() => setActiveTab('users')}\n-                className={`px-6 py-4 text-sm font-medium border-b-2 ${\n-                  activeTab === 'users'\n-                    ? 'border-blue-500 text-blue-600'\n-                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n-                }`}\n-              >\n-                Gestión de Usuarios\n-              </button>\n-              <button\n-                onClick={() => setActiveTab('config')}\n-                className={`px-6 py-4 text-sm font-medium border-b-2 ${\n-                  activeTab === 'config'\n-                    ? 'border-blue-500 text-blue-600'\n-                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n-                }`}\n-              >\n-                Configuración\n-              </button>\n+          <button\n+            onClick={() => setActiveTab('users')}\n+            className={`px-6 py-4 text-sm font-medium border-b-2 ${\n+              activeTab === 'users'\n+                ? 'border-blue-500 text-blue-600'\n+                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n+            }`}\n+          >\n+            Gestión de Usuarios\n+          </button>\n+          <button\n+            onClick={() => setActiveTab('config')}\n+            className={`px-6 py-4 text-sm font-medium border-b-2 ${\n+              activeTab === 'config'\n+                ? 'border-blue-500 text-blue-600'\n+                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n+            }`}\n+          >\n+            Configuración\n+          </button>\n+          <button\n+            onClick={() => setActiveTab('catalog')}\n+            className={`px-6 py-4 text-sm font-medium border-b-2 ${\n+              activeTab === 'catalog'\n+                ? 'border-blue-500 text-blue-600'\n+                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n+            }`}\n+          >\n+            Catálogo de Fichas\n+          </button>\n             </nav>\n           </div>\n \n           {/* Tab Content */}\n@@ -360,8 +532,22 @@\n                         </div>\n \n                         <div>\n                           <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                            {editingUser ? 'Confirmar nueva contraseña' : 'Confirmar contraseña *'}\n+                          </label>\n+                          <input\n+                            type=\"password\"\n+                            name=\"passwordConfirm\"\n+                            value={formData.passwordConfirm}\n+                            onChange={handleInputChange}\n+                            required={!editingUser || !!formData.password}\n+                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n+                          />\n+                        </div>\n+\n+                        <div>\n+                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                             Rol *\n                           </label>\n                           <select\n                             name=\"rol\"\n@@ -391,8 +577,27 @@\n                           </select>\n                         </div>\n                       </div>\n \n+                      {editingUser && editingUser.id_usuario === user?.id && (\n+                        <div className=\"mt-4\">\n+                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n+                            Contraseña anterior {formData.password ? '*' : '(solo si vas a cambiarla)'}\n+                          </label>\n+                          <input\n+                            type=\"password\"\n+                            name=\"currentPassword\"\n+                            value={formData.currentPassword}\n+                            onChange={handleInputChange}\n+                            required={!!formData.password}\n+                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n+                          />\n+                          <p className=\"text-xs text-gray-500 mt-1\">\n+                            Solo se solicita cuando vas a actualizar tu propia contraseña.\n+                          </p>\n+                        </div>\n+                      )}\n+\n                       <div className=\"flex gap-2\">\n                         <button\n                           type=\"submit\"\n                           disabled={loading}\n@@ -509,8 +714,126 @@\n \n             {activeTab === 'config' && (\n               <SystemConfig />\n             )}\n+            {activeTab === 'catalog' && (\n+              <div className=\"space-y-6\">\n+                <div className=\"bg-white rounded-lg shadow-md p-6\">\n+                  <h2 className=\"text-xl font-semibold text-gray-800 mb-4\">Fichas - Creación manual</h2>\n+                  <form onSubmit={handleFichaFormSubmit} className=\"space-y-4\">\n+                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n+                      <input\n+                        type=\"text\"\n+                        value={fichaForm.codigo_ficha}\n+                        onChange={(e) => handleFichaFormChange('codigo_ficha', e.target.value)}\n+                        placeholder=\"Código de ficha\"\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                        required\n+                      />\n+                      <select\n+                        value={fichaForm.codigo_programa}\n+                        onChange={(e) => handleFichaFormChange('codigo_programa', e.target.value)}\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                        required\n+                      >\n+                        <option value=\"\">Seleccione programa</option>\n+                        {catalogPrograms.map(program => (\n+                          <option key={program.codigo_programa} value={program.codigo_programa}>\n+                            {program.codigo_programa} · {program.nombre_programa}\n+                          </option>\n+                        ))}\n+                      </select>\n+                      <select\n+                        value={fichaForm.jornada}\n+                        onChange={(e) => handleFichaFormChange('jornada', e.target.value)}\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      >\n+                        <option value=\"diurna\">Diurna</option>\n+                        <option value=\"nocturna\">Nocturna</option>\n+                        <option value=\"mixta\">Mixta</option>\n+                      </select>\n+                    </div>\n+                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n+                      <input\n+                        type=\"date\"\n+                        value={fichaForm.fecha_inicio}\n+                        onChange={(e) => handleFichaFormChange('fecha_inicio', e.target.value)}\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      />\n+                      <input\n+                        type=\"date\"\n+                        value={fichaForm.fecha_fin}\n+                        onChange={(e) => handleFichaFormChange('fecha_fin', e.target.value)}\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      />\n+                      <select\n+                        value={fichaForm.estado}\n+                        onChange={(e) => handleFichaFormChange('estado', e.target.value)}\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      >\n+                        <option value=\"activa\">Activa</option>\n+                        <option value=\"finalizada\">Finalizada</option>\n+                        <option value=\"cancelada\">Cancelada</option>\n+                      </select>\n+                    </div>\n+                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n+                      <input\n+                        type=\"number\"\n+                        min={0}\n+                        value={fichaForm.numero_aprendices}\n+                        onChange={(e) => handleFichaFormChange('numero_aprendices', e.target.value)}\n+                        placeholder=\"Número de aprendices\"\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      />\n+                      <input\n+                        type=\"number\"\n+                        min={0}\n+                        value={fichaForm.capacidad_maxima}\n+                        onChange={(e) => handleFichaFormChange('capacidad_maxima', e.target.value)}\n+                        placeholder=\"Capacidad máxima\"\n+                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      />\n+                      <div />\n+                    </div>\n+                    <textarea\n+                      value={fichaForm.descripcion}\n+                      placeholder=\"Observaciones (opcional)\"\n+                      onChange={(e) => handleFichaFormChange('descripcion', e.target.value)}\n+                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n+                      rows={2}\n+                    />\n+                    <div className=\"flex items-center gap-3\">\n+                      <button\n+                        type=\"submit\"\n+                        className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold\"\n+                      >\n+                        Crear ficha\n+                      </button>\n+                      {fichaFeedback && (\n+                        <p className={`text-sm ${fichaFeedback.type === 'error' ? 'text-red-600' : 'text-green-600'}`}>\n+                          {fichaFeedback.message}\n+                        </p>\n+                      )}\n+                    </div>\n+                  </form>\n+                </div>\n+                <div className=\"bg-white rounded-lg shadow-md p-6\">\n+                  <h3 className=\"text-lg font-semibold text-gray-800 mb-4\">Programas activos</h3>\n+                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n+                    {catalogPrograms.map(program => (\n+                      <div key={program.id_programa} className=\"border border-gray-200 rounded-lg p-4\">\n+                        <p className=\"text-sm text-gray-500\">{program.codigo_programa}</p>\n+                        <h4 className=\"font-semibold text-gray-800\">{program.nombre_programa}</h4>\n+                        <p className=\"text-xs text-gray-500 mt-1\">Nivel: {program.nivel}</p>\n+                      </div>\n+                    ))}\n+                    {catalogPrograms.length === 0 && (\n+                      <p className=\"text-sm text-gray-500\">No hay programas activos disponibles.</p>\n+                    )}\n+                  </div>\n+                </div>\n+              </div>\n+            )}\n           </div>\n         </div>\n       </div>\n     </div>\n"
                },
                {
                    "date": 1764234096843,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -84,8 +84,9 @@\n     capacidad_maxima: '',\n     descripcion: ''\n   });\n   const [fichaFeedback, setFichaFeedback] = useState(null);\n+  const [showCatalogDropdown, setShowCatalogDropdown] = useState(false);\n \n   useEffect(() => {\n     if (activeTab === 'users') {\n       loadUsers();\n@@ -377,18 +378,34 @@\n             }`}\n           >\n             Configuración\n           </button>\n-          <button\n-            onClick={() => setActiveTab('catalog')}\n-            className={`px-6 py-4 text-sm font-medium border-b-2 ${\n-              activeTab === 'catalog'\n-                ? 'border-blue-500 text-blue-600'\n-                : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n-            }`}\n-          >\n-            Catálogo de Fichas\n-          </button>\n+          <div className=\"relative\">\n+            <button\n+              onClick={() => setShowCatalogDropdown(prev => !prev)}\n+              className={`px-6 py-4 text-sm font-medium border-b-2 inline-flex items-center gap-2 ${\n+                activeTab === 'catalog'\n+                  ? 'border-blue-500 text-blue-600'\n+                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n+              }`}\n+            >\n+              Administración\n+              <span className=\"text-xs\">▼</span>\n+            </button>\n+            {showCatalogDropdown && (\n+              <div className=\"absolute right-0 mt-1 bg-white border border-gray-200 rounded shadow-lg z-20\">\n+                <button\n+                  onClick={() => {\n+                    setActiveTab('catalog');\n+                    setShowCatalogDropdown(false);\n+                  }}\n+                  className=\"block text-left w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\"\n+                >\n+                  Fichas\n+                </button>\n+              </div>\n+            )}\n+          </div>\n             </nav>\n           </div>\n \n           {/* Tab Content */}\n"
                },
                {
                    "date": 1764234255371,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,6 +1,7 @@\n // Admin Panel - Gestión completa del sistema\n import React, { useState, useEffect } from 'react';\n+import { useLocation } from 'react-router-dom';\n import { userAPI, catalogAPI } from '../services/api.js';\n import { useAuth } from '../context/AuthContext.jsx';\n import SystemConfig from '../components/SystemConfig.jsx';\n \n@@ -61,8 +62,9 @@\n   const [editingUser, setEditingUser] = useState(null);\n   const [searchTerm, setSearchTerm] = useState('');\n   const [filterRole, setFilterRole] = useState('all');\n   const [filterEstado, setFilterEstado] = useState('all');\n+  const location = useLocation();\n   const [formData, setFormData] = useState({\n     nombre: '',\n     email: '',\n     password: '',\n@@ -87,8 +89,17 @@\n   const [fichaFeedback, setFichaFeedback] = useState(null);\n   const [showCatalogDropdown, setShowCatalogDropdown] = useState(false);\n \n   useEffect(() => {\n+    const tabParam = new URLSearchParams(location.search).get('tab');\n+    if (tabParam === 'catalog' && activeTab !== 'catalog') {\n+      setActiveTab('catalog');\n+    } else if (tabParam === 'config' && activeTab !== 'config') {\n+      setActiveTab('config');\n+    }\n+  }, [location.search]);\n+\n+  useEffect(() => {\n     if (activeTab === 'users') {\n       loadUsers();\n     } else if (activeTab === 'catalog') {\n       loadCatalogPrograms();\n"
                },
                {
                    "date": 1764234630097,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,7 @@\n // Admin Panel - Gestión completa del sistema\n import React, { useState, useEffect } from 'react';\n-import { useLocation } from 'react-router-dom';\n-import { userAPI, catalogAPI } from '../services/api.js';\n+import { userAPI } from '../services/api.js';\n import { useAuth } from '../context/AuthContext.jsx';\n import SystemConfig from '../components/SystemConfig.jsx';\n \n const isDigitString = (value) => /^\\d+$/.test(value);\n@@ -74,36 +73,12 @@\n     estado: 'ACTIVO'\n   });\n   const { user } = useAuth();\n   const [catalogPrograms, setCatalogPrograms] = useState([]);\n-  const [fichaForm, setFichaForm] = useState({\n-    codigo_ficha: '',\n-    codigo_programa: '',\n-    jornada: 'diurna',\n-    fecha_inicio: '',\n-    fecha_fin: '',\n-    estado: 'activa',\n-    numero_aprendices: 0,\n-    capacidad_maxima: '',\n-    descripcion: ''\n-  });\n-  const [fichaFeedback, setFichaFeedback] = useState(null);\n-  const [showCatalogDropdown, setShowCatalogDropdown] = useState(false);\n \n   useEffect(() => {\n-    const tabParam = new URLSearchParams(location.search).get('tab');\n-    if (tabParam === 'catalog' && activeTab !== 'catalog') {\n-      setActiveTab('catalog');\n-    } else if (tabParam === 'config' && activeTab !== 'config') {\n-      setActiveTab('config');\n-    }\n-  }, [location.search]);\n-\n-  useEffect(() => {\n     if (activeTab === 'users') {\n       loadUsers();\n-    } else if (activeTab === 'catalog') {\n-      loadCatalogPrograms();\n     }\n   }, [activeTab]);\n \n   useEffect(() => {\n@@ -153,61 +128,9 @@\n       setLoading(false);\n     }\n   };\n \n-  const loadCatalogPrograms = async () => {\n-    try {\n-      const response = await catalogAPI.getAllPrograms({ estado: 'activo' });\n-      if (response.success) {\n-        setCatalogPrograms(response.data || []);\n-      }\n-    } catch (err) {\n-      console.error('Error cargando programas del catálogo:', err);\n-    }\n-  };\n \n-  const handleFichaFormChange = (field, value) => {\n-    setFichaForm(prev => ({\n-      ...prev,\n-      [field]: value\n-    }));\n-  };\n-\n-  const handleFichaFormSubmit = async (event) => {\n-    event.preventDefault();\n-    setFichaFeedback({ type: 'info', message: 'Guardando ficha...' });\n-    try {\n-      const payload = {\n-        ...fichaForm,\n-        numero_aprendices: Number(fichaForm.numero_aprendices) || 0\n-      };\n-      const result = await catalogAPI.createFicha(payload);\n-      if (result.success) {\n-        setFichaFeedback({ type: 'success', message: 'Ficha creada exitosamente' });\n-        setFichaForm({\n-          codigo_ficha: '',\n-          codigo_programa: '',\n-          jornada: 'diurna',\n-          fecha_inicio: '',\n-          fecha_fin: '',\n-          estado: 'activa',\n-          numero_aprendices: 0,\n-          capacidad_maxima: ''\n-        });\n-        loadCatalogPrograms();\n-      } else {\n-        setFichaFeedback({ type: 'error', message: result.message || 'No se pudo crear la ficha' });\n-      }\n-    } catch (error) {\n-      console.error('Error creando ficha:', error);\n-      setFichaFeedback({\n-        type: 'error',\n-        message: error.response?.data?.message || 'Error al crear la ficha'\n-      });\n-    }\n-    setTimeout(() => setFichaFeedback(null), 4000);\n-  };\n-\n   const handleInputChange = (e) => {\n     setFormData({\n       ...formData,\n       [e.target.name]: e.target.value\n"
                },
                {
                    "date": 1764234984184,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,9 +61,8 @@\n   const [editingUser, setEditingUser] = useState(null);\n   const [searchTerm, setSearchTerm] = useState('');\n   const [filterRole, setFilterRole] = useState('all');\n   const [filterEstado, setFilterEstado] = useState('all');\n-  const location = useLocation();\n   const [formData, setFormData] = useState({\n     nombre: '',\n     email: '',\n     password: '',\n@@ -72,9 +71,8 @@\n     rol: 'GUARDA',\n     estado: 'ACTIVO'\n   });\n   const { user } = useAuth();\n-  const [catalogPrograms, setCatalogPrograms] = useState([]);\n \n   useEffect(() => {\n     if (activeTab === 'users') {\n       loadUsers();\n@@ -312,34 +310,8 @@\n             }`}\n           >\n             Configuración\n           </button>\n-          <div className=\"relative\">\n-            <button\n-              onClick={() => setShowCatalogDropdown(prev => !prev)}\n-              className={`px-6 py-4 text-sm font-medium border-b-2 inline-flex items-center gap-2 ${\n-                activeTab === 'catalog'\n-                  ? 'border-blue-500 text-blue-600'\n-                  : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n-              }`}\n-            >\n-              Administración\n-              <span className=\"text-xs\">▼</span>\n-            </button>\n-            {showCatalogDropdown && (\n-              <div className=\"absolute right-0 mt-1 bg-white border border-gray-200 rounded shadow-lg z-20\">\n-                <button\n-                  onClick={() => {\n-                    setActiveTab('catalog');\n-                    setShowCatalogDropdown(false);\n-                  }}\n-                  className=\"block text-left w-full px-4 py-2 text-sm text-gray-700 hover:bg-gray-100\"\n-                >\n-                  Fichas\n-                </button>\n-              </div>\n-            )}\n-          </div>\n             </nav>\n           </div>\n \n           {/* Tab Content */}\n@@ -665,126 +637,8 @@\n \n             {activeTab === 'config' && (\n               <SystemConfig />\n             )}\n-            {activeTab === 'catalog' && (\n-              <div className=\"space-y-6\">\n-                <div className=\"bg-white rounded-lg shadow-md p-6\">\n-                  <h2 className=\"text-xl font-semibold text-gray-800 mb-4\">Fichas - Creación manual</h2>\n-                  <form onSubmit={handleFichaFormSubmit} className=\"space-y-4\">\n-                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n-                      <input\n-                        type=\"text\"\n-                        value={fichaForm.codigo_ficha}\n-                        onChange={(e) => handleFichaFormChange('codigo_ficha', e.target.value)}\n-                        placeholder=\"Código de ficha\"\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                        required\n-                      />\n-                      <select\n-                        value={fichaForm.codigo_programa}\n-                        onChange={(e) => handleFichaFormChange('codigo_programa', e.target.value)}\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                        required\n-                      >\n-                        <option value=\"\">Seleccione programa</option>\n-                        {catalogPrograms.map(program => (\n-                          <option key={program.codigo_programa} value={program.codigo_programa}>\n-                            {program.codigo_programa} · {program.nombre_programa}\n-                          </option>\n-                        ))}\n-                      </select>\n-                      <select\n-                        value={fichaForm.jornada}\n-                        onChange={(e) => handleFichaFormChange('jornada', e.target.value)}\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      >\n-                        <option value=\"diurna\">Diurna</option>\n-                        <option value=\"nocturna\">Nocturna</option>\n-                        <option value=\"mixta\">Mixta</option>\n-                      </select>\n-                    </div>\n-                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n-                      <input\n-                        type=\"date\"\n-                        value={fichaForm.fecha_inicio}\n-                        onChange={(e) => handleFichaFormChange('fecha_inicio', e.target.value)}\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      />\n-                      <input\n-                        type=\"date\"\n-                        value={fichaForm.fecha_fin}\n-                        onChange={(e) => handleFichaFormChange('fecha_fin', e.target.value)}\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      />\n-                      <select\n-                        value={fichaForm.estado}\n-                        onChange={(e) => handleFichaFormChange('estado', e.target.value)}\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      >\n-                        <option value=\"activa\">Activa</option>\n-                        <option value=\"finalizada\">Finalizada</option>\n-                        <option value=\"cancelada\">Cancelada</option>\n-                      </select>\n-                    </div>\n-                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n-                      <input\n-                        type=\"number\"\n-                        min={0}\n-                        value={fichaForm.numero_aprendices}\n-                        onChange={(e) => handleFichaFormChange('numero_aprendices', e.target.value)}\n-                        placeholder=\"Número de aprendices\"\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      />\n-                      <input\n-                        type=\"number\"\n-                        min={0}\n-                        value={fichaForm.capacidad_maxima}\n-                        onChange={(e) => handleFichaFormChange('capacidad_maxima', e.target.value)}\n-                        placeholder=\"Capacidad máxima\"\n-                        className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      />\n-                      <div />\n-                    </div>\n-                    <textarea\n-                      value={fichaForm.descripcion}\n-                      placeholder=\"Observaciones (opcional)\"\n-                      onChange={(e) => handleFichaFormChange('descripcion', e.target.value)}\n-                      className=\"w-full px-3 py-2 border border-gray-300 rounded-lg\"\n-                      rows={2}\n-                    />\n-                    <div className=\"flex items-center gap-3\">\n-                      <button\n-                        type=\"submit\"\n-                        className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold\"\n-                      >\n-                        Crear ficha\n-                      </button>\n-                      {fichaFeedback && (\n-                        <p className={`text-sm ${fichaFeedback.type === 'error' ? 'text-red-600' : 'text-green-600'}`}>\n-                          {fichaFeedback.message}\n-                        </p>\n-                      )}\n-                    </div>\n-                  </form>\n-                </div>\n-                <div className=\"bg-white rounded-lg shadow-md p-6\">\n-                  <h3 className=\"text-lg font-semibold text-gray-800 mb-4\">Programas activos</h3>\n-                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n-                    {catalogPrograms.map(program => (\n-                      <div key={program.id_programa} className=\"border border-gray-200 rounded-lg p-4\">\n-                        <p className=\"text-sm text-gray-500\">{program.codigo_programa}</p>\n-                        <h4 className=\"font-semibold text-gray-800\">{program.nombre_programa}</h4>\n-                        <p className=\"text-xs text-gray-500 mt-1\">Nivel: {program.nivel}</p>\n-                      </div>\n-                    ))}\n-                    {catalogPrograms.length === 0 && (\n-                      <p className=\"text-sm text-gray-500\">No hay programas activos disponibles.</p>\n-                    )}\n-                  </div>\n-                </div>\n-              </div>\n-            )}\n           </div>\n         </div>\n       </div>\n     </div>\n"
                }
            ],
            "date": 1764016711161,
            "name": "Commit-0",
            "content": "// Admin Panel - Gestión completa del sistema\nimport React, { useState, useEffect } from 'react';\nimport { userAPI } from '../services/api.js';\nimport { useAuth } from '../context/AuthContext.jsx';\nimport SystemConfig from '../components/SystemConfig.jsx';\n\nconst AdminPanel = () => {\n  const [activeTab, setActiveTab] = useState('users');\n  const [users, setUsers] = useState([]);\n  const [filteredUsers, setFilteredUsers] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n  const [showUserForm, setShowUserForm] = useState(false);\n  const [editingUser, setEditingUser] = useState(null);\n  const [searchTerm, setSearchTerm] = useState('');\n  const [filterRole, setFilterRole] = useState('all');\n  const [filterEstado, setFilterEstado] = useState('all');\n  const [formData, setFormData] = useState({\n    nombre: '',\n    email: '',\n    password: '',\n    rol: 'GUARDA',\n    estado: 'ACTIVO'\n  });\n  const { user } = useAuth();\n\n  useEffect(() => {\n    if (activeTab === 'users') {\n      loadUsers();\n    }\n  }, [activeTab]);\n\n  useEffect(() => {\n    // Filtrar usuarios cuando cambian los filtros\n    let filtered = users;\n\n    if (searchTerm) {\n      filtered = filtered.filter(u =>\n        u.nombre?.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        u.email?.toLowerCase().includes(searchTerm.toLowerCase())\n      );\n    }\n\n    if (filterRole !== 'all') {\n      filtered = filtered.filter(u => {\n        const userRol = u.rol ? u.rol.toUpperCase() : '';\n        const filterRolUpper = filterRole.toUpperCase();\n        // Mapear 'admin' a 'ADMINISTRADOR' para comparación\n        if (filterRolUpper === 'ADMIN') {\n          return userRol === 'ADMIN' || userRol === 'ADMINISTRADOR';\n        }\n        return userRol === filterRolUpper;\n      });\n    }\n\n    if (filterEstado !== 'all') {\n      filtered = filtered.filter(u => {\n        const userEstado = u.estado ? u.estado.toUpperCase() : '';\n        const filterEstadoUpper = filterEstado.toUpperCase();\n        return userEstado === filterEstadoUpper;\n      });\n    }\n\n    setFilteredUsers(filtered);\n  }, [users, searchTerm, filterRole, filterEstado]);\n\n  const loadUsers = async () => {\n    try {\n      setLoading(true);\n      const response = await userAPI.getAll();\n      if (response.success) {\n        setUsers(response.users || []);\n      }\n    } catch (err) {\n      setError('Error al cargar usuarios');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInputChange = (e) => {\n    setFormData({\n      ...formData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    setError('');\n    setSuccess('');\n    setLoading(true);\n\n    try {\n      if (editingUser) {\n        // Actualizar usuario\n        const updateData = { ...formData };\n        if (!updateData.password) {\n          delete updateData.password;\n        }\n        await userAPI.update(editingUser.id_usuario, updateData);\n        setSuccess('Usuario actualizado exitosamente');\n      } else {\n        // Crear usuario\n        if (!formData.password) {\n          setError('La contraseña es requerida para nuevos usuarios');\n          setLoading(false);\n          return;\n        }\n        await userAPI.create(formData);\n        setSuccess('Usuario creado exitosamente');\n      }\n      \n      setShowUserForm(false);\n      setEditingUser(null);\n      setFormData({\n        nombre: '',\n        email: '',\n        password: '',\n        rol: 'GUARDA',\n        estado: 'ACTIVO'\n      });\n      loadUsers();\n    } catch (err) {\n      setError(err.response?.data?.message || 'Error al guardar usuario');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleEdit = (userToEdit) => {\n    setEditingUser(userToEdit);\n    setFormData({\n      nombre: userToEdit.nombre,\n      email: userToEdit.email,\n      password: '',\n      rol: userToEdit.rol,\n      estado: userToEdit.estado\n    });\n    setShowUserForm(true);\n  };\n\n  const handleDelete = async (userId) => {\n    if (!window.confirm('¿Está seguro de eliminar este usuario?')) {\n      return;\n    }\n\n    try {\n      setLoading(true);\n      setError('');\n      setSuccess('');\n      const response = await userAPI.delete(userId);\n      \n      if (response.success) {\n        // Actualizar el estado local inmediatamente removiendo el usuario\n        setUsers(prevUsers => prevUsers.filter(u => u.id_usuario !== userId));\n        setSuccess('Usuario eliminado exitosamente');\n        \n        // Recargar usuarios para asegurar sincronización con el backend\n        await loadUsers();\n      } else {\n        setError(response.message || 'Error al eliminar usuario');\n      }\n    } catch (err) {\n      const errorMessage = err.response?.data?.message || 'Error al eliminar usuario';\n      setError(errorMessage);\n      console.error('Error al eliminar usuario:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleCancel = () => {\n    setShowUserForm(false);\n    setEditingUser(null);\n    setFormData({\n      nombre: '',\n      email: '',\n      password: '',\n      rol: 'guarda',\n      estado: 'activo'\n    });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-100 p-4 md:p-6\">\n      <div className=\"max-w-7xl mx-auto\">\n        {/* Header */}\n        <div className=\"mb-6\">\n          <h1 className=\"text-3xl font-bold text-gray-800 mb-2\">Gestión de Usuarios</h1>\n          <p className=\"text-gray-600\">Gestión completa del sistema</p>\n        </div>\n\n        {/* Tabs */}\n        <div className=\"bg-white rounded-lg shadow-lg mb-6\">\n          <div className=\"border-b border-gray-200\">\n            <nav className=\"flex -mb-px\">\n              <button\n                onClick={() => setActiveTab('users')}\n                className={`px-6 py-4 text-sm font-medium border-b-2 ${\n                  activeTab === 'users'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                Gestión de Usuarios\n              </button>\n              <button\n                onClick={() => setActiveTab('config')}\n                className={`px-6 py-4 text-sm font-medium border-b-2 ${\n                  activeTab === 'config'\n                    ? 'border-blue-500 text-blue-600'\n                    : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'\n                }`}\n              >\n                Configuración\n              </button>\n            </nav>\n          </div>\n\n          {/* Tab Content */}\n          <div className=\"p-6\">\n            {activeTab === 'users' && (\n              <div>\n                <div className=\"flex flex-col md:flex-row md:justify-between md:items-center mb-4 gap-4\">\n                  <h2 className=\"text-xl font-bold text-gray-800\">Usuarios del Sistema</h2>\n                  {!showUserForm && (\n                    <button\n                      onClick={() => setShowUserForm(true)}\n                      className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold\"\n                    >\n                      + Nuevo Usuario\n                    </button>\n                  )}\n                </div>\n\n                {/* Búsqueda y Filtros */}\n                {!showUserForm && (\n                  <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Buscar\n                        </label>\n                        <input\n                          type=\"text\"\n                          placeholder=\"Buscar por nombre o email...\"\n                          value={searchTerm}\n                          onChange={(e) => setSearchTerm(e.target.value)}\n                          className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                        />\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Filtrar por Rol\n                        </label>\n                        <select\n                          value={filterRole}\n                          onChange={(e) => setFilterRole(e.target.value)}\n                          className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                        >\n                          <option value=\"all\">Todos los roles</option>\n                          <option value=\"ADMINISTRADOR\">Administrador</option>\n                          <option value=\"GUARDA\">Guarda</option>\n                          <option value=\"admin\">Admin (legacy)</option>\n                        </select>\n                      </div>\n                      <div>\n                        <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                          Filtrar por Estado\n                        </label>\n                        <select\n                          value={filterEstado}\n                          onChange={(e) => setFilterEstado(e.target.value)}\n                          className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                        >\n                          <option value=\"all\">Todos los estados</option>\n                          <option value=\"ACTIVO\">Activo</option>\n                          <option value=\"INACTIVO\">Inactivo</option>\n                          <option value=\"activo\">Activo (legacy)</option>\n                          <option value=\"inactivo\">Inactivo (legacy)</option>\n                        </select>\n                      </div>\n                    </div>\n                    {(searchTerm || filterRole !== 'all' || filterEstado !== 'all') && (\n                      <button\n                        onClick={() => {\n                          setSearchTerm('');\n                          setFilterRole('all');\n                          setFilterEstado('all');\n                        }}\n                        className=\"mt-4 text-sm text-blue-600 hover:text-blue-700 font-medium\"\n                      >\n                        Limpiar filtros\n                      </button>\n                    )}\n                  </div>\n                )}\n\n                {error && (\n                  <div className=\"mb-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n                    {error}\n                  </div>\n                )}\n\n                {success && (\n                  <div className=\"mb-4 bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg\">\n                    {success}\n                  </div>\n                )}\n\n                {showUserForm && (\n                  <div className=\"bg-gray-50 rounded-lg p-6 mb-6\">\n                    <h3 className=\"text-lg font-bold text-gray-800 mb-4\">\n                      {editingUser ? 'Editar Usuario' : 'Nuevo Usuario'}\n                    </h3>\n                    <form onSubmit={handleSubmit} className=\"space-y-4\">\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Nombre Completo *\n                          </label>\n                          <input\n                            type=\"text\"\n                            name=\"nombre\"\n                            value={formData.nombre}\n                            onChange={handleInputChange}\n                            required\n                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Email *\n                          </label>\n                          <input\n                            type=\"email\"\n                            name=\"email\"\n                            value={formData.email}\n                            onChange={handleInputChange}\n                            required\n                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            {editingUser ? 'Nueva Contraseña (dejar vacío para mantener)' : 'Contraseña *'}\n                          </label>\n                          <input\n                            type=\"password\"\n                            name=\"password\"\n                            value={formData.password}\n                            onChange={handleInputChange}\n                            required={!editingUser}\n                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                          />\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Rol *\n                          </label>\n                          <select\n                            name=\"rol\"\n                            value={formData.rol}\n                            onChange={handleInputChange}\n                            required\n                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                          >\n                            <option value=\"GUARDA\">Guarda de Seguridad</option>\n                            <option value=\"ADMINISTRADOR\">Administrador</option>\n                          </select>\n                        </div>\n\n                        <div>\n                          <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                            Estado *\n                          </label>\n                            <select\n                            name=\"estado\"\n                            value={formData.estado}\n                            onChange={handleInputChange}\n                            required\n                            className=\"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none\"\n                          >\n                            <option value=\"ACTIVO\">Activo</option>\n                            <option value=\"INACTIVO\">Inactivo</option>\n                          </select>\n                        </div>\n                      </div>\n\n                      <div className=\"flex gap-2\">\n                        <button\n                          type=\"submit\"\n                          disabled={loading}\n                          className=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold disabled:opacity-50\"\n                        >\n                          {loading ? 'Guardando...' : editingUser ? 'Actualizar' : 'Crear'}\n                        </button>\n                        <button\n                          type=\"button\"\n                          onClick={handleCancel}\n                          className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 px-6 py-2 rounded-lg font-semibold\"\n                        >\n                          Cancelar\n                        </button>\n                      </div>\n                    </form>\n                  </div>\n                )}\n\n                {loading && !showUserForm ? (\n                  <div className=\"text-center py-8\">\n                    <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto\"></div>\n                  </div>\n                ) : (\n                  <div className=\"bg-white border border-gray-200 rounded-lg overflow-hidden\">\n                    <table className=\"min-w-full divide-y divide-gray-200\">\n                      <thead className=\"bg-gray-50\">\n                        <tr>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Nombre\n                          </th>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Email\n                          </th>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Rol\n                          </th>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Estado\n                          </th>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Acciones\n                          </th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {filteredUsers.length === 0 ? (\n                          <tr>\n                            <td colSpan=\"5\" className=\"px-6 py-8 text-center text-gray-500\">\n                              {searchTerm || filterRole !== 'all' || filterEstado !== 'all' \n                                ? 'No se encontraron usuarios con los filtros aplicados'\n                                : 'No hay usuarios registrados'}\n                            </td>\n                          </tr>\n                        ) : (\n                          filteredUsers.map((u) => (\n                            <tr key={u.id_usuario} className=\"hover:bg-gray-50\">\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                                {u.nombre}\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                {u.email}\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                <span className={`px-2 py-1 rounded-full text-xs font-semibold ${\n                                  (u.rol?.toUpperCase() === 'ADMIN' || u.rol?.toUpperCase() === 'ADMINISTRADOR') \n                                    ? 'bg-purple-100 text-purple-800' \n                                    : 'bg-blue-100 text-blue-800'\n                                }`}>\n                                  {(u.rol?.toUpperCase() === 'ADMIN' || u.rol?.toUpperCase() === 'ADMINISTRADOR') \n                                    ? 'Administrador' \n                                    : 'Guarda'}\n                                </span>\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                <span className={`px-2 py-1 rounded-full text-xs font-semibold ${\n                                  (u.estado?.toUpperCase() === 'ACTIVO') ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'\n                                }`}>\n                                  {(u.estado?.toUpperCase() === 'ACTIVO') ? 'Activo' : 'Inactivo'}\n                                </span>\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium\">\n                                <div className=\"flex gap-2\">\n                                  <button\n                                    onClick={() => handleEdit(u)}\n                                    className=\"text-blue-600 hover:text-blue-900\"\n                                  >\n                                    Editar\n                                  </button>\n                                  {u.id_usuario !== user?.id && (\n                                    <button\n                                      onClick={() => handleDelete(u.id_usuario)}\n                                      className=\"text-red-600 hover:text-red-900\"\n                                    >\n                                      Eliminar\n                                    </button>\n                                  )}\n                                </div>\n                              </td>\n                            </tr>\n                          ))\n                        )}\n                      </tbody>\n                    </table>\n                    {filteredUsers.length > 0 && (\n                      <div className=\"px-6 py-4 bg-gray-50 text-sm text-gray-600\">\n                        Mostrando {filteredUsers.length} de {users.length} usuarios\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n            )}\n\n            {activeTab === 'config' && (\n              <SystemConfig />\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AdminPanel;\n"
        }
    ]
}