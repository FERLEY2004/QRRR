{
    "sourceFile": "control-acceso-sena/backend/src/utils/createFichasTable.sql",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763535572846,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763535572846,
            "name": "Commit-0",
            "content": "-- =====================================================\r\n-- TABLA: Fichas\r\n-- Sistema de Control de Acceso SENA\r\n-- =====================================================\r\n\r\nUSE control_acceso_sena;\r\n\r\n-- Crear tabla Fichas si no existe\r\nCREATE TABLE IF NOT EXISTS Fichas (\r\n    id_ficha INT AUTO_INCREMENT PRIMARY KEY,\r\n    codigo_ficha VARCHAR(50) UNIQUE NOT NULL COMMENT 'Código único de la ficha (ej: 3066232)',\r\n    programa_formacion VARCHAR(200) NOT NULL COMMENT 'Nombre del programa de formación',\r\n    id_programa INT NULL COMMENT 'Referencia al programa de formación',\r\n    id_ambiente_principal INT NULL COMMENT 'Ambiente principal asignado a la ficha',\r\n    jornada ENUM('diurna', 'nocturna', 'mixta') DEFAULT 'diurna' COMMENT 'Jornada de formación',\r\n    fecha_inicio DATE NULL COMMENT 'Fecha de inicio de la ficha',\r\n    fecha_fin DATE NULL COMMENT 'Fecha de finalización de la ficha',\r\n    estado ENUM('activa', 'finalizada', 'cancelada') DEFAULT 'activa' COMMENT 'Estado actual de la ficha',\r\n    numero_aprendices INT DEFAULT 0 COMMENT 'Número de aprendices asignados',\r\n    capacidad_maxima INT NULL COMMENT 'Capacidad máxima de aprendices',\r\n    observaciones TEXT NULL COMMENT 'Observaciones adicionales',\r\n    fecha_creacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\r\n    fecha_actualizacion TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\r\n    \r\n    -- Foreign Keys\r\n    FOREIGN KEY (id_programa) REFERENCES Programas_Formacion(id_programa) ON DELETE SET NULL,\r\n    FOREIGN KEY (id_ambiente_principal) REFERENCES Ambientes(id_ambiente) ON DELETE SET NULL,\r\n    \r\n    -- Índices\r\n    INDEX idx_ficha_codigo (codigo_ficha),\r\n    INDEX idx_ficha_programa (id_programa),\r\n    INDEX idx_ficha_estado (estado),\r\n    INDEX idx_ficha_jornada (jornada),\r\n    INDEX idx_ficha_fechas (fecha_inicio, fecha_fin),\r\n    INDEX idx_ficha_ambiente (id_ambiente_principal)\r\n    \r\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\r\nCOMMENT='Tabla para gestionar las fichas de formación del SENA';\r\n\r\n-- Agregar foreign key desde Personas a Fichas si no existe\r\n-- Nota: MySQL no soporta IF NOT EXISTS en ALTER TABLE ADD FOREIGN KEY\r\n-- Se debe ejecutar manualmente si la tabla ya tiene datos y la foreign key no existe\r\n-- ALTER TABLE Personas \r\n-- ADD CONSTRAINT fk_personas_ficha \r\n-- FOREIGN KEY (id_ficha) REFERENCES Fichas(id_ficha) ON DELETE SET NULL;\r\n\r\n-- Verificar que la columna id_ficha existe en Personas\r\n-- Si no existe, se creará automáticamente al ejecutar el schema completo\r\n-- ALTER TABLE Personas \r\n-- ADD COLUMN IF NOT EXISTS id_ficha INT NULL AFTER ficha;\r\n\r\n-- Crear índice en Personas para id_ficha si no existe\r\nCREATE INDEX IF NOT EXISTS idx_personas_ficha_id ON Personas(id_ficha);\r\n\r\n-- Datos de ejemplo (opcional)\r\n-- INSERT INTO Fichas (codigo_ficha, programa_formacion, jornada, fecha_inicio, fecha_fin, estado) VALUES\r\n-- ('3066232', 'Técnico en Programación de Software', 'diurna', '2024-01-15', '2025-01-15', 'activa'),\r\n-- ('3066233', 'Tecnólogo en Análisis y Desarrollo de Software', 'nocturna', '2024-02-01', '2026-02-01', 'activa')\r\n-- ON DUPLICATE KEY UPDATE codigo_ficha=codigo_ficha;\r\n\r\n"
        }
    ]
}